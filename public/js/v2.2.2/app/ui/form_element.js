define(["jquery","app/init","app/util","app/map/util"],(e,t,s,n)=>{"use strict";let a={resultOptionImageClass:"pf-result-image",select2ImageLazyLoadClass:"pf-select2-image-lazyLoad"},l=e=>{if(e.loading)return e.text;if(e.placeholder)return e.placeholder;let t=`<div class="clearfix ${a.resultOptionImageClass}">`;if(e.hasOwnProperty("children"))t+=`<div class="col-xs-9">${e.text}</div>`,t+=`<div class="col-xs-3 text-right">(${e.children.length})</div>`;else{let n="",l="",i="";switch(e.categoryType){case"character":n=s.eveImageUrl("characters",e.id);break;case"corporation":n=s.eveImageUrl("corporations",e.id);break;case"alliance":n=s.eveImageUrl("alliances",e.id);break;case"inventoryType":case"render":n=s.eveImageUrl("types",e.id);break;case"station":l="fa-home";break;case"system":l="fa-sun"}n?i=`<img class="${a.select2ImageLazyLoadClass}" src="${s.imgRoot()}svg/logo_simple.svg" data-src="${n}" style="max-width: 100%"/>`:l&&(i=`<i class="fas fa-fw ${l}"></i>`),t+=`<div class="col-xs-2">${i}</div>`,t+=`<div class="col-xs-10 pf-text-ellipsis">${e.text}</div>`}return t+="</div>"},i=(n,a,l)=>{let i=n.text.split(" - "),r="";if(2===i.length){let e,n=i[0];s.getObjVal(l,"showWhSizeLabel")&&(e=s.getObjVal(t,`wormholes.${n}.size.label`)||"");let a=s.getSecurityClassForSystem(c(i[1])),o=i[1].split(/\s(.+)/),d=o[0],u=o[1]?o[1]:"",p=[a,s.config.popoverTriggerClass,s.config.helpDefaultClass];r+=`<span>${n}</span>`,void 0!==e&&(r+=`<span><kbd>${e}</kbd></span>`),r+='<i class="fas fa-long-arrow-alt-right txt-color txt-color-grayLight"></i>',r+=`<span class="${p.join(" ")}" data-name="${n}">&nbsp;&nbsp;${d}</span>`,u.length&&(r+=`&nbsp;<span>${u}</span>`)}else r+=`<span>${n.text}</span>`;return e(r)},r=(t,a)=>{if(t.loading)return t.text;if(t.placeholder)return t.placeholder;let l='<div class="clearfix">';if(t.hasOwnProperty("children"))l+='<div class="col-xs-9">'+t.text+"</div>",l+='<div class="col-xs-3 text-right">('+t.children.length+")</div>";else{let e=t.text.split(" - ");if(2===e.length){let t=s.getSecurityClassForSystem(n.getSystemSecurityForClass(e[1]));switch(a){case"wormhole":let s=e[1].split(/\s(.+)/),n=s[0],i=s[1]?s[1]:"";l+='<div class="col-xs-3">'+e[0]+"</div>",l+='<div class="col-xs-2 text-center"><i class="fas fa-long-arrow-alt-right txt-color txt-color-grayLight"></i></div>',l+='<div class="col-xs-3 '+t+'">'+n+"</div>",l+='<div class="col-xs-4 text-right">'+i+"</div>";break;case"system":l+='<div class="col-xs-10">'+e[0]+"</div>",l+='<div class="col-xs-2 '+t+'">'+e[1]+"</div>"}}else l+='<div class="col-xs-12">'+t.text+"</div>"}return e(l+="</div>")},o=t=>{let a=t.text.split(" - "),l="";if(2===a.length){let e=["pf-fake-connection-text"];if(t.metaData){let s=t.metaData;if(s.type){let t=s.type;t.includes("wh_eol")&&e.push("pf-wh-eol"),t.includes("wh_reduced")&&e.push("pf-wh-reduced"),t.includes("wh_critical")&&e.push("pf-wh-critical"),t.includes("wh_jump_mass_s")&&e.push("pf-wh-frig")}}let i=s.getSecurityClassForSystem(n.getSystemSecurityForClass(a[1]));l+=`<span class="${e.join(" ")}">${a[0]}</span>`,l+=`<span class="${i}">&nbsp;&nbsp;${a[1]}</span>`}else l+=`<span>${t.text}</span>`;return e(l)},c=e=>{let t=e.match(/^(\w+\.?\w?)/i);return t?t[1]:""};return e.fn.initMapSelect=function(){let t=e(this);e.when(t.select2({dropdownParent:t.parents(".modal-body"),maximumSelectionLength:5}))},e.fn.initConnectionSizeSelect=function(a){let l=e(this),i={dropdownParent:l.parents(".modal-body"),minimumResultsForSearch:1/0,width:"100%",maxSelectionLength:1},r=a=>{if(a.loading)return a.text;if(a.placeholder)return a.placeholder;let l=n.getConnectionInfo(a.text,"cssClass"),i='<div class="clearfix">';return i+='<div class="col-xs-1">',i+='<i class="fas fa-char fa-fw" data-char-content="'+(s.getObjVal(t.wormholeSizes,a.text+".label")||"?")+'"></i>',i+="</div>",i+='<div class="col-xs-3">',i+='<div class="pf-fake-connection '+l+'"></div>',i+="</div>",i+='<div class="col-xs-8">',i+=s.getObjVal(t.wormholeSizes,a.text+".text")||"all",i+="</div>",e(i+="</div>")};(a=e.extend({},i,a)).templateSelection=r,a.templateResult=r,e.when(l.select2(a))},e.fn.initStatusSelect=function(t){let s={minimumResultsForSearch:1/0,width:"100%",iconClass:"fa-circle"};return(t=e.extend({},s,t)).templateSelection=(e=>'<i class="fas '+t.iconClass+" "+e.class+'"></i>&nbsp;&nbsp;&nbsp;'+e.text),t.templateResult=(s=>{if(s.loading)return s.text;if(s.placeholder)return s.placeholder;let n='<div class="clearfix '+a.resultOptionImageClass+'">';return n+='<div class="col-xs-2">',n+='<i class="fas '+t.iconClass+" "+s.class+'"></i>',n+="</div>",n+='<div class="col-xs-10">'+s.text+"</div>",e(n+="</div>")}),this.each(function(){e(this).select2(t)})},e.fn.initSystemSelect=function(l){let i=e(this);l=e.extend({},{maxSelectionLength:1},l);let r=s.getSecurityClassForSystem("SH");e.when(i.select2({ajax:{url:e=>`${t.path.api}/SystemSearch/${e.term.trim()}`,dataType:"json",delay:250,timeout:5e3,cache:!0,data:e=>({page:e.page||1}),processResults:function(e,t){return{results:e.results.map(function(e){let t=e[l.key],a=!1,i=parseFloat(e.trueSec),r=s.getSecurityClassForSystem(e.security),o=s.getTrueSecClassForSystem(i),c=n.getEffectInfoForSystem(e.effect,"class");return l.disabledOptions&&-1!==l.disabledOptions.indexOf(parseInt(t,10))&&(a=!0),i=i>0&&i<.1?.1:Math.round(10*i)/10,{id:t,text:e.name,security:e.security,secClass:r,trueSec:i.toFixed(1),trueSecClass:o,effect:e.effect,effectClass:c,shattered:e.shattered,disabled:a}}),pagination:{more:e.pagination.more}}},error:function(e,t,n){if(!s.isXHRAborted(e)){let a=t+" "+e.status+": "+n;s.showNotify({title:"System select warning",text:a+" deleted",type:"warning"})}}},dropdownParent:i.parents(".modal-body"),minimumInputLength:3,templateResult:function(e){if(e.loading)return e.text;let t="A"===e.security?s.config.fontTriglivianClass:"",n=null===e.effect?"hide":"",l=e.shattered?"":"hide",i='<div class="clearfix '+a.resultOptionImageClass+'">';return i+='<div class="col-xs-4 pf-select-item-anchor '+t+'">'+e.text+"</div>",i+='<div class="col-xs-2 text-right '+e.effectClass+'">',i+='<i class="fas fa-fw fa-square '+n+'"></i>',i+="</div>",i+='<div class="col-xs-2 text-right '+e.secClass+'">'+e.security+"</div>",i+='<div class="col-xs-2 text-right '+r+'">',i+='<i class="fas fa-fw fa-chart-pie '+l+'"></i>',i+="</div>",i+='<div class="col-xs-2 text-right '+e.trueSecClass+'">'+e.trueSec+"</div></div>"},placeholder:"Name or ID",allowClear:!0,maximumSelectionLength:l.maxSelectionLength}).on("change",function(t){l.onChange&&l.onChange(parseInt(e(this).val())||0)}).on("select2:open",function(){1===l.maxSelectionLength&&null!==e(this).val()&&e(this).val("").trigger("change")})).done(function(t,s){null===e(this).val()&&i.select2("open")})},e.fn.initAccessSelect=function(n){let a=e=>{if(e.loading)return e.text;let t='<div class="clearfix">';return t+='<div class="col-sm-10">'+e.text+"</div></div>"};return this.each(function(){let i=e(this);e.when(i.select2({ajax:{url:function(e){return t.path.searchAccess+"/"+n.type+"/"+e.term},dataType:"json",delay:250,timeout:5e3,cache:!0,data:function(e){},processResults:function(e,t){return{results:e.map(function(e){return{id:e.id,text:e.name,categoryType:n.type}})}},error:function(e,t,n){if(!s.isXHRAborted(e)){let a=t+" "+e.status+": "+n;s.showNotify({title:"Access select warning",text:a+" deleted",type:"warning"})}}},dropdownParent:i.parents(".modal-body"),minimumInputLength:3,placeholder:n.type+" names",allowClear:!1,maximumSelectionLength:n.maxSelectionLength,templateResult:l,templateSelection:a}).on("change",function(e){})).done(function(){})})},e.fn.initUniverseSearch=function(n){let a=e=>{s.showNotify({title:"Search failed",text:e+" deleted",type:"warning"})};function i(e,t){let s=(e,t)=>{let s=new Array(e.length+1);for(let e=0;e<s.length;e++)s[e]=new Array(t.length+1).fill(0);for(let t=1;t<=e.length;t++)s[t][0]=t;for(let e=1;e<=t.length;e++)s[0][e]=e;for(let n=1;n<=t.length;n++)for(let a=1;a<=e.length;a++)s[a][n]=Math.min(s[a-1][n]+1,s[a][n-1]+1,s[a-1][n-1]+(e[a-1]===t[n-1]?0:1));return s[e.length][t.length]};e.sort((e,n)=>{let a=s(t,e.name.toLowerCase()),l=s(t,n.name.toLowerCase());return a===l?0:a>l?1:-1})}return this.each(function(){let r=e(this);e.when(r.select2({ajax:{type:"POST",url:function(e){return t.path.searchUniverseData+"/"+encodeURI(e.term)},dataType:"json",delay:250,timeout:5e3,cache:!0,data:function(e){return{categories:n.categoryNames}},processResults:function(e,t){let s={results:[]};if(e.hasOwnProperty("error"))a(e.error);else{let n=function(e){return{id:e.id,text:e.name,categoryType:this}};for(let a in e)e.hasOwnProperty(a)&&(i(e[a],t.term),s.results.push({text:a,children:e[a].map(n,a)}))}return s},error:function(e,t,n){if(!s.isXHRAborted(e)){let s=t+" "+e.status+": "+n;a(s)}}},dropdownParent:r.parents(".modal-body"),minimumInputLength:3,placeholder:"",disabled:!!n.hasOwnProperty("disabled")&&n.disabled,allowClear:n.maxSelectionLength<=1,maximumSelectionLength:n.maxSelectionLength,templateResult:l}).on("change",function(e){}).on("select2:open",function(){1===n.maxSelectionLength&&null!==e(this).val()&&e(this).val("").trigger("change")})).done(function(){})})},e.fn.initUniverseTypeSelect=function(n){let a=e=>{let n=[],a=function(e){return{id:e.id,text:e.name,mass:e.hasOwnProperty("mass")?e.mass:null,groupId:this.groupId,categoryId:this.categoryId,categoryType:this.categoryType}};for(let l of e){let e=s.getObjVal(t,"universeCategories."+l);if(e&&e.groups)for(let t of e.groups)t&&t.types&&n.push({text:t.name,children:t.types.map(a,{groupId:t.id,categoryId:e.id,categoryType:"inventoryType"})})}return n};return this.each(function(){let t=e(this);e.when(t.select2({data:a(n.categoryIds),dropdownParent:t.parents(".modal-body"),minimumInputLength:0,maximumInputLength:100,placeholder:"",allowClear:n.maxSelectionLength<=1,multiple:n.maxSelectionLength>1,maximumSelectionLength:n.maxSelectionLength,templateResult:l}).on("select2:open",function(){1===n.maxSelectionLength&&null!==e(this).val()&&e(this).val("").trigger("change")}).val(n.selected).trigger("change"))})},e.fn.initSignatureGroupSelect=function(t){let s={minimumResultsForSearch:1/0,width:"110px",dropdownParent:this.parents(".popover-content")};return t=e.extend({},s,t),this.each(function(){let s=e(this);s.select2(t),parseInt(s.val())||setTimeout(()=>{s.select2("open")},0)})},e.fn.initSignatureTypeSelect=function(t,s){let n={minimumResultsForSearch:10,width:"220px",dropdownParent:this.parents(".popover-content")},a=(t,s)=>{if(""===e.trim(t.term))return s;if(void 0===s.children)return null;let n=[];for(let[e,a]of Object.entries(s.children))0===a.text.toUpperCase().indexOf(t.term.toUpperCase())&&n.push(a);if(n.length){let t=e.extend({},s,!0);return t.children=n,t}return null};return(t=e.extend({},n,t)).templateSelection=i,t.templateResult=(e=>r(e,"wormhole")),s&&(t.matcher=a),this.each(function(){let s=e(this);s.select2(t),parseInt(s.val())||setTimeout(()=>{s.select2("open")},0)})},e.fn.initSignatureConnectionSelect=function(t){let s={minimumResultsForSearch:1/0,width:"140px",dropdownParent:this.parents(".popover-content")};return(t=e.extend({},s,t)).templateSelection=o,t.templateResult=(e=>r(e,"system")),this.each(function(){let s=e(this);t.data&&s.empty(),s.select2(t),parseInt(s.val())||setTimeout(()=>{s.select2("open")},0)})},{formatSignatureTypeSelectionData:i,formatSignatureConnectionSelectionData:o}});
//# sourceMappingURL=form_element.js.map
