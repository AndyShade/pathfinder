define(["jquery","app/init","app/util","bootbox"],(t,e,a,o)=>{"use strict";let s="pf-settings-dialog",n="pf-settings-dialog-account",i="pf-settings-dialog-share",r="pf-settings-dialog-character",c="SESSION.CAPTCHA.ACCOUNT.UPDATE",l="pf-dialog-captcha-wrapper",g="pf-dialog-captcha-image";t.fn.showSettingsDialog=function(){if(a.getOpenDialogs().length>0)return!1;requirejs(["text!templates/dialog/settings.html","mustache"],function(f,d){let h={id:s,settingsAccountContainerId:n,settingsShareContainerId:i,settingsCharacterContainerId:r,userData:e.currentUserData,captchaImageWrapperId:l,captchaImageId:g,formErrorContainerClass:a.config.formErrorContainerClass,ccpImageServer:e.url.ccpImageServer,roleLabel:a.getLabelByRole(a.getCurrentCharacterData("role")).prop("outerHTML"),characterAutoLocationSelectEnabled:Boolean(a.getObjVal(e,"character.autoLocationSelect")),hasRightCorporationShare:a.hasRight("map_share","corporation")},p=d.render(f,h),u=o.dialog({title:"Account settings",message:p,show:!1,buttons:{close:{label:"cancel",className:"btn-default"},success:{label:'<i class="fas fa-check fa-fw"></i>&nbsp;save',className:"btn-success",callback:function(){let o=t("#"+s).find("form").filter(":visible");if(o.validator("validate"),!0===o.isValidForm()){let s={formData:o.getFormValues()};u.find(".modal-content").showLoadingAnimation(),t.ajax({type:"POST",url:e.path.saveUserConfig,data:s,dataType:"json"}).done(function(e){u.find(".modal-content").hideLoadingAnimation(),e.error&&e.error.length>0?(o.showFormMessage(e.error),t("#"+l).showCaptchaImage(c,function(){t("#captcha").resetFormFields()})):(e.userData&&a.setCurrentUserData(e.userData),o.find(".alert").velocity("transition.slideDownOut",{duration:500,complete:function(){t("#"+l).showCaptchaImage(c,function(){t("#captcha").resetFormFields()})}}),a.showNotify({title:"Account saved",type:"success"}),a.triggerMenuAction(document,"Close"),u.modal("hide"))}).fail(function(e,s,n){u.find(".modal-content").hideLoadingAnimation();let i=s+" "+n;if(a.showNotify({title:e.status+": saveAccountSettings",text:i,type:"error"}),t("#"+l).showCaptchaImage(c,function(){t("#captcha").resetFormFields()}),500===e.status&&e.responseText){let a=t.parseJSON(e.responseText);a.error&&a.error.length>0&&o.showFormMessage(a.error)}t(document).setProgramStatus("problem")})}return!1}}}});u.on("show.bs.modal",function(e){let a=t("#"+l);a.showCaptchaImage(c),a.find("i").on("click",function(){a.showCaptchaImage(c)})}),u.on("shown.bs.modal",function(e){let a=t(this),o=a.find("form");a.initTooltips(),o.initFormValidation(),a.find('input[type="checkbox"][data-toggle="toggle"]').bootstrapToggle({on:'<i class="fas fa-fw fa-check"></i>&nbsp;Enable',off:'Disable&nbsp;<i class="fas fa-fw fa-ban"></i>',onstyle:"success",offstyle:"warning",width:100,height:30})}),u.modal("show")})}});
//# sourceMappingURL=account_settings.js.map
