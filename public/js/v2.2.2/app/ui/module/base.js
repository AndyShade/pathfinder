define(["jquery","app/init","app/util","app/map/util","app/lib/cache","app/promises/promise.deferred","app/promises/promise.queue"],(e,t,n,s,o,a,i)=>{"use strict";let l=class BaseModule{constructor(e={}){if(new.target===BaseModule)throw new TypeError("Cannot construct "+this.constructor.name+" instances directly");if(void 0===this.render)throw new TypeError("Abstract method render() missing in "+new.target.name+" class");this._config=Object.assign({},BaseModule.defaultConfig,e),this._updateQueue=new i}get config(){return this._config}get moduleElement(){return this._moduleEl||(this._moduleEl=Object.assign(document.createElement("div"),{className:`${BaseModule.className} ${this._config.className}`,style:{opacity:"0"}}).setData("module",this),this._moduleEl.dataset.position=this._config.position,this._moduleEl.dataset.module=this.constructor.name,this._moduleEl.append(this.newHeaderElement())),this._moduleEl}newHeaderElement(e){let t=this.newHeadElement();return t.append(this.newHandlerElement(),this.newHeadlineElement(e||this._config.headline)),t}newHeadElement(){return Object.assign(document.createElement("div"),{className:this._config.headClassName})}newHandlerElement(){return Object.assign(document.createElement("h5"),{className:this._config.handlerClassName})}newHeadlineElement(e){return Object.assign(document.createElement("h5"),{textContent:"string"==typeof e?e:""})}newHeadlineToolbarElement(){return Object.assign(document.createElement("h5"),{className:"pull-right"})}newIconElement(e=[]){return Object.assign(document.createElement("i"),{className:["fas",...e].join(" ")})}newLabelElement(e,t=[]){let n=document.createElement("span");return n.classList.add("label","center-block",...t),n.textContent=e||"",n}newControlElement(e,t=[],n=["fa-sync"]){let s=document.createElement("div");return s.classList.add(...[BaseModule.Util.config.dynamicAreaClass,this._config.controlAreaClass,...t]),s.insertAdjacentHTML("beforeend",`&nbsp;&nbsp;${e}`),s.prepend(this.newIconElement(n)),s}request(...e){return BaseModule.Util.request(...e)}getLocalStore(){return this._localStore||(this._localStore=BaseModule.Util.getLocalStore("module"),this._localStore.scope=this.constructor.name),this._localStore}showNotify(...e){return BaseModule.Util.showNotify(...e)}handle(e,...t){try{if(BaseModule.handler.includes(e)){let n=this[e].apply(this,t);return n instanceof Promise&&n.then(()=>{this.logHandler(e,0)}),this.logHandler(e),n}console.error("Error in module %o. Invalid handler %o",this.constructor.name,e)}catch(t){console.error("Error in module %o in handler %s() %o",this.constructor.name,e,t)}}logHandler(e,t=1){t&&(this._config.logHandler||(this._config.logHandler={}),this._config.logHandler[e]=(this._config.logHandler[e]||0)+t)}init(){}update(e){return this._updateQueue.enqueue(()=>Promise.resolve(e),"end","upd")}beforeHide(){}beforeDestroy(){e(this.moduleElement).destroyPopover(!0);for(let t of e(this.moduleElement).find("table.dataTable"))e(t).DataTable().destroy(!0)}onSortableEvent(e,t){"onUnchoose"===e&&this._sortableChoosePromise&&this._sortableChoosePromise.resolve(),"onChoose"!==e||this._sortableChoosePromise||(this._sortableChoosePromise=BaseModule.newDeferredPromise(),this._updateQueue.enqueue(()=>this._sortableChoosePromise.then(()=>{this._sortableChoosePromise=null}),"start"))}static getConnectionDataCacheKey(e,t){let n=!1;return e&&t&&(n="con_"+`${[String(e).toLowerCase(),String(t).toLowerCase()].sort()}`.hashCode()),n}static getConnectionsDataFromMaps(e){let t={};for(let n of e){let e=s.getMapInstance(n);if(e){let s=`map_${n}`,o=BaseModule.getCache("mapConnections"),a=o.get(s);a||(a=this.getConnectionsDataFromConnections(n,e.getAllConnections()),o.set(s,a)),Object.assign(t,a)}}return t}static getConnectionsDataFromConnections(e=0,t=[]){let n={};if(t.length){let o=s.getDataByConnections(t);for(let t of o){let s=BaseModule.getConnectionDataCacheKey(t.sourceName,t.targetName);s&&!Object.keys(n).includes(s)&&(n[s]={map:{id:e},connection:{id:t.id,type:t.type,scope:t.scope,updated:t.updated},source:{id:t.source,name:t.sourceName,alias:t.sourceAlias},target:{id:t.target,name:t.targetName,alias:t.targetAlias}})}}return n}static findConnectionsData(e,t,n){return this.Util.getObjVal(e,this.getConnectionDataCacheKey(t,n))}static getFakeConnectionData(e,t,n="stargate",o=[]){return{connection:{id:0,scope:n,type:o.length?o:[s.getDefaultConnectionTypeByScope(n)],updated:0},source:{id:0,name:e.system,alias:e.system},target:{id:0,name:t.system,alias:t.system}}}static getFakeConnectionElement(e){let t=this.Util.getObjVal(e,"map.id")||0,n=this.Util.getObjVal(e,"connection.id")||0,o=this.Util.getObjVal(e,"connection.scope")||"",a=s.getConnectionFakeClassesByTypes(this.Util.getObjVal(e,"connection.type")||[]),i='<div data-mapId="'+t+'" data-connectionId="'+n+'" ';return i+=!t||!n?"data-disabled":"",i+=' class="'+a.join(" ")+'" ',i+=' title="'+o+'" data-placement="bottom"></div>'}static getCache(e){let t=`CACHE-${e}`;if(!this.Util.getObjVal(this,t)){let n=`cacheConfig.${e}`,s=this.Util.getObjVal(this,n);s?s.name=e:(console.warn("Missing Cache config for %o. Expected at %o. Default config loadedâ€¦",e,`${this.name}.${n}`),s={}),this[t]=new o(s)}return this[t]}static now(){return(new Date).getTime()/1e3}static getOrderPrio(){return this.isPlugin?this.scopeOrder.indexOf("plugin"):-1!==this.scopeOrder.indexOf(this.scope)?this.scopeOrder.indexOf(this.scope):this.scopeOrder.length-1}static newDeferredPromise(){return new a}};return l.isPlugin=!0,l.scope="system",l.sortArea="a",l.position=0,l.label="???",l.className="pf-module",l.fullDataUpdate=!1,l.Util=n,l.scopeOrder=["system","connection","global","plugin","undefined"],l.handler=["render","init","update","beforeHide","beforeDestroy","onSortableEvent"],l.cacheConfig={mapConnections:{ttl:5,maxSize:600,debug:!1}},l.defaultConfig={position:1,className:"pf-base-module",headClassName:"pf-module-head",handlerClassName:"pf-sortable-handle",sortTargetAreas:["a","b","c"],headline:"Base headline",bodyClassName:"pf-module-body",controlAreaClass:"pf-module-control-area",moduleHeadlineIconClass:"pf-module-icon-button"},l});
//# sourceMappingURL=base.js.map
