define(["jquery","app/init","app/lib/prototypes","app/lib/console","app/lib/cache","app/lib/localStore","app/lib/resize","conf/system_effect","conf/signature_type","lazyload","bootbox","velocity","velocityUI","customScrollbar","validator","easyPieChart","hoverIntent","bootstrapConfirmation","bootstrapToggle","select2"],(e,t,a,r,n,o,s,i,l,c,d)=>{"use strict";let p,u={ajaxOverlayClass:"pf-loading-overlay",ajaxOverlayWrapperClass:"pf-loading-overlay-wrapper",noScrollClass:"no-scroll",formEditableFieldClass:"pf-editable",formErrorContainerClass:"pf-dialog-error-container",formWarningContainerClass:"pf-dialog-warning-container",formInfoContainerClass:"pf-dialog-info-container",headMapTrackingId:"pf-head-map-tracking",headUserLocationId:"pf-head-user-location",menuButtonFullScreenId:"pf-menu-button-fullscreen",menuButtonMagnetizerId:"pf-menu-button-magnetizer",menuButtonGridId:"pf-menu-button-grid",menuButtonRegionId:"pf-menu-button-region",menuButtonCompactId:"pf-menu-button-compact",menuButtonEndpointId:"pf-menu-button-endpoint",menuButtonMapDeleteId:"pf-menu-button-map-delete",footerId:"pf-footer",footerCenterClass:"pf-footer-center",globalInfoPanelId:"pf-global-info",settingsMessageVelocityOptions:{duration:180},dialogClass:"modal-dialog",mapModuleId:"pf-map-module",mapTabBarIdPrefix:"pf-map-tab-bar-",mapTabBarClass:"pf-map-tab-bar",mapTabContentClass:"pf-map-tab-content",mapTabContentAreaClass:"pf-map-tab-content-area",mapTabContentAreaAliases:["map","a","b","c"],mapClass:"pf-map",userStatusClass:"pf-user-status",dynamicAreaClass:"pf-dynamic-area",select2Class:"pf-select2",select2ImageLazyLoadClass:"pf-select2-image-lazyLoad",animationPulseClassPrefix:"pf-animation-pulse-",popoverClass:"pf-popover",popoverTriggerClass:"pf-popover-trigger",popoverSmallClass:"popover-small",popoverCharacterClass:"pf-popover-character",popoverListIconClass:"pf-popover-list-icon",summernoteClass:"pf-summernote",helpDefaultClass:"pf-help-default",helpClass:"pf-help",fontTriglivianClass:"pf-triglivian",localStoreNames:["default","character","map","module"]},f=new n({name:"currentSystemData",ttl:-1,maxSize:20}),m=document.title,g={},h={};e.fn.showLoadingAnimation=function(t){return this.each(function(){let a=e(this),r=Z(t,"icon.size")||"fa-lg",n=e("<div>",{class:u.ajaxOverlayClass}).css("pointer-events","none").append(e("<div>",{class:[u.ajaxOverlayWrapperClass].join(" ")}).append(e("<i>",{class:["fas",r,"fa-sync","fa-spin"].join(" ")})));a.append(n),e(n).velocity({opacity:.6},{duration:120})})},e.fn.hideLoadingAnimation=function(){return this.each(function(){let t=e(this).find("."+u.ajaxOverlayClass);t.length&&(t.css("pointer-events","auto"),t.velocity("stop").velocity("reverse",{complete:function(){this.forEach(e=>{e.remove()})}}))})},e.fn.showSplashOverlay=function(a){e(this).velocity("fadeIn",{duration:t.animationSpeed.splashOverlay,complete:function(){void 0!==a&&a()}})},e.fn.hideSplashOverlay=function(){e(this).velocity("fadeOut",{duration:t.animationSpeed.splashOverlay})},e.fn.showCaptchaImage=function(t,a){return this.each(function(){let r=e(this),n=r.find("img");r.showLoadingAnimation(u.loadingOptions),T(t,function(e){n.attr("src",e).show(),r.hideLoadingAnimation({icon:{size:"fa-2x"}}),a&&a()})})},e.fn.resetFormFields=function(){return this.each(function(){let t=e(this);t.is("select")||t.val(""),t.parents(".form-group").removeClass("has-error has-success")})},e.fn.showFormMessage=function(t){let a=e(this),r=[],n=[],o=[];for(let e of t){let t=`${e.text}`;if("error"===e.type){if(t=`${e.status} - ${t}`,r.push(t),e.field&&e.field.length>0){a.find('[name="'+e.field+'"]').parents(".form-group").removeClass("has-success").addClass("has-error").find(".help-block").text(e.text)}}else"warning"===e.type?n.push(t):"info"===e.type&&o.push(t)}r.length>0&&a.hideFormMessage("error",function(t){e(t).find("small").html(r.join("<br>")),e(t).velocity("transition.slideUpIn",u.settingsMessageVelocityOptions)}),n.length>0&&a.hideFormMessage("warning",function(t){e(t).find("small").html(n.join("<br>")),e(t).velocity("transition.slideUpIn",u.settingsMessageVelocityOptions)}),o.length>0&&a.hideFormMessage("info",function(t){e(t).find("small").html(o.join("<br>")),e(t).velocity("transition.slideUpIn",u.settingsMessageVelocityOptions)})},e.fn.hideFormMessage=function(t,a){let r=e(this),n=e.extend({},u.settingsMessageVelocityOptions);void 0!==a&&(n.complete=a,n.display="block");let o=null;switch(t){case"error":o=r.find("."+u.formErrorContainerClass);break;case"warning":o=r.find("."+u.formWarningContainerClass);break;case"info":o=r.find("."+u.formInfoContainerClass);break;case"all":o=r.find("."+u.formErrorContainerClass+", ."+u.formWarningContainerClass+", ."+u.formInfoContainerClass)}o&&(o.is(":visible")?o.velocity("transition.slideDownOut",n):a&&a(o))},e.fn.initFormValidation=function(t){return t=void 0===t?{}:t,this.each(function(){let a=e(this);a.validator(t),a.on("valid.bs.validator",function(t){let a=e(t.relatedTarget).parents(".form-group");a&&a.removeClass("has-error").addClass("has-success")}),a.on("invalid.bs.validator",function(t){let a=e(t.relatedTarget).parents(".form-group");a&&a.removeClass("has-success").addClass("has-error")})})},e.fn.isValidForm=function(){let t=!1;return 0===e(this).find(".has-error").length&&(t=!0),t},e.fn.initMapUpdateCounter=function(){let t=[[0,[217,83,79]],[10,[217,83,79]],[50,[240,173,78]],[75,[79,158,79]],[100,[86,138,137]]],a=(e,t,a)=>{let r=a,n=1-r;return[Math.round(e[0]*r+t[0]*n),Math.round(e[1]*r+t[1]*n),Math.round(e[2]*r+t[2]*n)]};e(this).easyPieChart({barColor:e=>(e=>{e=e||1;let r=t.findIndex(t=>e<=t[0]),n=[r-1,r],o=t[n[0]][1],s=t[n[1]][1],i=t[n[0]][0]/100*500,l=t[n[1]][0]/100*500-i;return`rgb(${a(s,o,(e/100*500-i)/l).join()})`})(Number(Number(e).toFixed(1))),trackColor:"#2b2b2b",size:30,scaleColor:!1,lineWidth:2,animate:{duration:550,enabled:!0},easing:function(e,t,a,r,n){return-r/2*(Math.cos(Math.PI*t/n)-1)+a}})},e.fn.initTooltips=function(t={}){let a=[".modal",".popover"];return this.each(function(){let r=e(this).find("[title]");if(r.length){let e=Object.assign({},t);if(!t.hasOwnProperty("container")){let t=((e,t=a)=>{for(let r=0;r<t.length;r++){let t=e.closest(a[r]);if(t)return t}})(this);t&&(e.container=t)}r.tooltip("destroy").tooltip(e)}})},e.fn.destroyTooltips=function(t){return this.each(function(){let a=e(this),r=a.filter("[title]");t&&(r=r.add(a.find("[title]"))),r.each(function(){e(this).tooltip("destroy")})})},e.fn.addCharacterInfoTooltip=function(a,r){let n={};if(a.created&&a.updated&&a.created.character&&a.updated.character){let o=a.created,s=a.updated,i=H(o.character,"class"),l=H(s.character,"class"),c=new Date(1e3*o.created),d=new Date(1e3*s.updated),p=G(c),f=G(d);n={popoverClass:u.popoverCharacterClass,ccpImageServerUrl:t.url.ccpImageServer,created:o,updated:s,createdTime:J(p),updatedTime:J(f),createdStatusClass:i,updatedStatusClass:l};let m={placement:"top",html:!0,trigger:"hover",container:"body",title:"Created / Updated",delay:{show:150,hide:0}};return r=e.extend({},m,r),this.each(function(){let t=e(this);requirejs(["text!templates/tooltip/character_info.html","mustache"],(e,a)=>{let o=a.render(e,n);t.popover(r),t.data("bs.popover").options.content=o,r.show&&t.popover("show")})})}return this},e.fn.initCharacterSwitchPopover=function(){let a=e(this),r=M();requirejs(["text!templates/tooltip/character_switch.html","mustache"],function(n,o){let s={popoverClass:u.popoverCharacterClass,browserTabId:A(),routes:t.routes,userData:r,otherCharacters:()=>r.characters.filter((e,t)=>{let a=v("characters",e.id);return(new Image).src=a,r.characters[t].image=a,e.id!==r.character.id})},i=o.render(n,s);return a.each(function(){let r=e(this);void 0!==r.data("bs.popover")&&r.off("click").popover("destroy"),r.on("click",function(a){a.preventDefault(),a.stopPropagation();let r=e(this),n=r.attr("data-easein"),o=r.data("bs.popover"),s=null,l={duration:t.animationSpeed.dialogEvents};void 0===o?(r.on("shown.bs.popover",function(t){e(this).data("bs.popover").tip().find(".btn").on("click",function(t){e("body").click()})}),r.popover({html:!0,title:"select character",trigger:"manual",placement:"bottom",content:i,animation:!1}).data("bs.popover").tip().addClass(u.popoverClass),r.popover("show"),(s=r.data("bs.popover").tip()).velocity("transition."+n,l),s.initTooltips(),s.on("click",".btn",function(){e("body").data("characterSwitch",!0),setTimeout(function(){e("body").removeData("characterSwitch")},500)})):(s=r.data("bs.popover").tip()).is(":visible")?s.velocity("reverse"):(r.popover("show"),s.initTooltips(),s.velocity("transition."+n,l))}),a.initPopoverClose("hideCharacterPopup")})})},e.fn.destroyPopover=function(t){return this.each(function(){let a=e(this),r="."+u.popoverTriggerClass,n=a.filter(r);t&&(n=n.add(a.find(r))),n.each(function(){let t=e(this);t.data("bs.popover")&&t.popover("destroy")})})},e.fn.initPopoverClose=function(t){return this.each(function(){e("body").off("click."+t).on("click."+t+" contextmenu",function(t){e("."+u.popoverTriggerClass).each(function(){let a=e(this);if(!a.is(t.target)&&0===a.has(t.target).length&&0===e(".popover").has(t.target).length){let e=a.data("bs.popover");void 0!==e&&e.tip().is(":visible")&&a.popover("hide")}})})})},e.fn.setPopoverSmall=function(){return this.each(function(){let t=e(this).data("bs.popover");t&&t.tip().addClass(u.popoverSmallClass)})},e.fn.showMessage=function(t){let a=e(this);requirejs(["text!templates/form/message.html","mustache"],function(r,n){let o="alert-danger",s="txt-color-danger";switch(t.type){case"info":o="alert-info",s="txt-color-information";break;case"success":o="alert-success",s="txt-color-success";break;case"warning":o="alert-warning",s="txt-color-warning"}let i={dismissible:!0,messageId:I("pf-alert-"),messageTypeClass:o,messageTextClass:s,insertElement:"replace"};i=e.extend(i,t);let l=n.render(r,i);switch(i.insertElement){case"replace":a.html(l);break;case"prepend":a.prepend(l);break;case"append":a.append(l);break;default:console.error("insertElement: %s is not specified!",i.insertElement)}e("#"+i.messageId).velocity("stop").velocity("fadeIn")})},e.fn.pulseBackgroundColor=function(t,a=!1,r=!1){let n=u.animationPulseClassPrefix;switch(t){case"added":n+="success";break;case"changed":n+="warning";break;case"deleted":n+="danger";break;default:console.warn("Invalid status: %s",t)}a&&(n+="-keep");let o=e=>{e.removeClass(n);let t=e.data("animationTimer");h.hasOwnProperty(t)&&(clearTimeout(t),delete h[t],e.removeData("animationTimer"))};return this.each(function(){let t=e(this);if(t.hasClass(n)&&o(t),!r&&(t.addClass(n),!a)){let e=setTimeout(o,1500,t);t.data("animationTimer",e),h[e]=!0}})};let b=()=>document.body.dataset.version,y=()=>`/public/img/${b()}/`,v=(e,a,r=32,n)=>{let o=!1;if("string"==typeof e&&"number"==typeof a&&"number"==typeof r){if(e=e.toLowerCase(),!n)switch(e){case"factions":e="corporations";case"alliances":case"corporations":n="logo";break;case"characters":n="portrait";break;case"types":n="icon";break;default:console.warn("Invalid resourceType: %o for in eveImageUrl()",e)}o=[t.url.ccpImageServer,e,a,n].join("/"),o+="?"+new URLSearchParams({size:r}).toString()}return o};const C=e=>{const t=e.replace(/\\u[\dA-F]{4}/gi,e=>String.fromCharCode(parseInt(e.replace(/\\u/g,""),16)));return"u'"==t.substring(0,2)?t.substring(2,t.length-1):t};let w=(e,t)=>{let a=["popover"];"small"===Z(t,"size")&&a.push("popover-small");let r='<div class="'+a.join(" ")+'">';return r+='<div class="arrow"></div>',!0!==Z(t,"noTitle")&&(r+='<h3 class="popover-title"></h3>'),r+='<div class="'+["popover-content","no-padding"].join(" ")+'">',r+=(e=>{let t=e||"";return t+='<div class="popover-footer">',t+=(()=>{let e='<div class="btn-group">';return e+='<a data-apply="confirmation">Yes</a>',e+='<a data-dismiss="confirmation">No</a>',e+="</div>"})(),t+="</div>"})(e),r+="</div>",r+="</div>"},S=(t=!0)=>{e("html").toggleClass(u.noScrollClass,!t)},T=(a,r)=>{e.ajax({type:"POST",url:t.path.getCaptcha,data:{reason:a},dataType:"json"}).done(function(e){e.error.length>0?D({title:"getCaptchaImage",text:"Captcha image generation failed",type:"error"}):r(e.img)}).fail(function(e,t,a){let r=t+" "+a;D({title:e.status+": getCaptchaImage",text:r,type:"error"})})},I=(e="id_")=>e+Math.random().toString(36).substring(2,10),D=(e={},t={})=>{requirejs(["pnotify.loader"],a=>{t.desktop&&e.title&&(t.desktop={icon:`${y()}misc/notification.png`},x(e.title)),a.showNotify(e,t)})},x=e=>{(function(){let t=0,a=e=>{window.isVisible&&t++,document.title=document.title===e?m:e,t>10&&k()};return()=>{p||(p=setInterval(a,1e3,e))}})()()},k=()=>{p&&(clearInterval(p),document.title=m,p=null)},M=()=>t.currentUserData,j=()=>Z(M(),"character")||!1,E=e=>Z(j(),e)||!1,O=()=>{let e=parseInt(E("id"))||0;return e||(e=parseInt(document.body.getAttribute("data-character-id"))),e},U=e=>{let t=M(),a=!1;if(t){let r=t.character;r&&("privateId"===e&&(a=r.id),"allianceId"===e&&r.alliance&&(a=r.alliance.id),"corporationId"===e&&r.corporation&&(a=r.corporation.id))}return a},L=(e,t)=>{let a=a=>Z(e,a)!==Z(t,a),r=(Z(e,"characters")||[]).map(e=>e.id).sort(),n=(Z(t,"characters")||[]).map(e=>e.id).sort(),o=(Z(e,"character.logHistory")||[]).map(e=>e.stamp).sort(),s=(Z(t,"character.logHistory")||[]).map(e=>e.stamp).sort();return{userId:a("id"),characterId:a("character.id"),characterLogLocation:a("character.logLocation"),characterSystemId:a("character.log.system.id"),characterShipType:a("character.log.ship.typeId"),characterStationId:a("character.log.station.id"),characterStructureId:a("character.log.structure.id"),charactersIds:r.toString()!==n.toString(),characterLogHistory:o.toString()!==s.toString()}},A=()=>{let e=sessionStorage.getItem("tabId");return null===e&&(e=I(),sessionStorage.setItem("tabId",e)),e},P=e=>{let t="";switch(e){case 0:t="connecting";break;case 1:t="open";break;case 2:t="closing";break;case 3:t="closed"}return t},F=(a,r)=>{let n=t.syncStatus;switch(a){case"ws:open":n.webSocket.status=P(r.readyState),n.webSocket.class="txt-color-success",n.webSocket.timestamp=(new Date).getTime()/1e3,n.type="webSocket",F("ajax:disable"),e(window).trigger("pf:syncStatus");break;case"ws:get":n.webSocket.timestamp=(new Date).getTime()/1e3,e(window).trigger("pf:syncStatus");break;case"ws:closed":n.webSocket.status=P(r.readyState),n.webSocket.class="txt-color-danger",n.webSocket.timestamp=void 0,F("ajax:enable");break;case"ws:error":n.webSocket.status=P(r.readyState),n.webSocket.class="txt-color-danger",F("ajax:enable");break;case"sw:init":n.sharedWorker.status="online",n.sharedWorker.class="txt-color-success";break;case"sw:error":n.sharedWorker.status="offline",n.sharedWorker.class="txt-color-danger",F("ajax:enable");break;case"ajax:enable":n.ajax.status="enabled",n.ajax.class="txt-color-success",n.ajax.timestamp=(new Date).getTime()/1e3,n.type="ajax",e(window).trigger("pf:syncStatus");break;case"ajax:get":n.ajax.timestamp=(new Date).getTime()/1e3,e(window).trigger("pf:syncStatus");break;case"ajax:disable":n.ajax.status="disabled",n.ajax.class="txt-color-warning"}},R=e=>{let t=0;switch(e){case"H":t=30;break;case"L":t=31;break;case"0.0":t=32;break;case"T":t=33;break;default:for(let a=1;a<=18;a++)if(e==="C"+a){t=a;break}}return t},H=(e,a)=>{let r="";if(t.characterStatus){let n=U("corporationId"),o=U("allianceId"),s=M();if(s){let n=s.characters;for(let o=0;o<n.length;o++)if(n[o].id===e.id){r=t.characterStatus.own[a];break}}""===r&&(e.corporation&&e.corporation.id===n?r=t.characterStatus.corporation[a]:e.alliance&&e.alliance.id===o&&(r=t.characterStatus.alliance[a]))}return r},N=(e,a="class")=>{let r="";return t.classes.planets.hasOwnProperty(e)&&(r=t.classes.planets[e][a]),r},_=e=>{let a="";return"C13"===e&&(e="SH"),t.classes.systemSecurity.hasOwnProperty(e)&&(a=t.classes.systemSecurity[e].class),a},B=e=>{let a="";return e=parseFloat(e),!isNaN(e)&&isFinite(e)&&(e<0&&(e=0),e=e.toFixed(1).toString(),t.classes.trueSec.hasOwnProperty(e)&&(a=t.classes.trueSec[e].class)),a},z=(e,t)=>{let a=!1;if(Array.isArray(e)&&t===parseInt(t,10))for(let r=0;r<e.length;r++)if(e[r].config.id===t){a=r;break}return a},V=a=>{let r=!1;if(t.currentMapUserData)if(a===parseInt(a,10)){for(let e=0;e<t.currentMapUserData.length;e++)if(t.currentMapUserData[e].config&&t.currentMapUserData[e].config.id===a){r=t.currentMapUserData[e];break}}else r=t.currentMapUserData;return!1!==r&&(r=e.extend(!0,{},r)),r},$=e=>{let a=!1;return t.currentMapData&&(a=e===parseInt(e,10)?t.currentMapData.find(t=>t.config.id===e):t.currentMapData),a},q=(e,t,a,r={})=>{let n=e=>{for(let a=0;a<t.data.systems.length;a++){let r=t.data.systems[a];if(r.id===e)return r}return!1};r[e.id]={distance:a};let o={systemData:e,tree:{}};if(--a>=0)for(let s=0;s<t.data.connections.length;s++){let i=t.data.connections[s],l="";if(i.source===e.id?l="target":i.target===e.id&&(l="source"),l&&(void 0===r[i[l]]||r[i[l]].distance<a)){let e=n(i[l]);e&&(o.tree[i[l]]=q(e,t,a,r))}}return o},W=(e,t)=>{if(e&&e.length)for(let a=0;a<e.length;a++)if(e[a].id===t)return e[a].user;return[]},Y=(e,t,a=0,r={})=>{let n=function(e){return this.id!==e.id},o=W(t,e.systemData.systemId);o.length&&(o=o.filter(function(e,t,o){let s=!0;for(let t in r)if(t>a){let a=r[t].filter(n,e);a.length>0?r[t]=a:delete r[t]}else for(let a=0;a<r[t].length;a++)if(r[t][a].id===e.id){s=!1;break}return s}),r[a]=r[a]?r[a]:[],r[a]=[...r[a],...o]),a++;for(let n in e.tree)if(e.tree.hasOwnProperty(n)){let o=e.tree[n];r=Y(o,t,a,r)}return r},X=e=>(parseInt(e)/1e3).toLocaleString()+" t",G=e=>new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds()),J=(e,t)=>{let a=("0"+(e.getMonth()+1)).slice(-2)+"/"+("0"+e.getDate()).slice(-2)+"/"+e.getFullYear(),r=("0"+e.getHours()).slice(-2)+":"+("0"+e.getMinutes()).slice(-2);return a+" "+(r+=t?":"+("0"+e.getSeconds()).slice(-2):"")},K=(e,...t)=>e+t.filter(Boolean).join("-"),Q=(...e)=>{let t=e.reduce((e,t)=>e.concatFilter(Object.values(t)),[]);return t.unshift(""),delete(t=Object.assign({},t))[0],t},Z=(e,t)=>t.split(".").reduce((e,t)=>void 0===e||null===e?e:e[t],e),ee=(e,t=[])=>{e!==document.URL&&(t&&t.length>0&&(e+="?"+t.join("&")),window.location=e)};return{config:u,getVersion:b,showVersionInfo:()=>r.showVersionInfo(b()),imgRoot:y,eveImageUrl:v,unicodeToString:C,initPassiveEvents:()=>{const e=!0,t=!1,a=["scroll","wheel","touchstart","touchmove","touchenter","touchend","touchleave","mouseout","mouseleave","mouseup","mousedown","mousemove","mouseenter","mousewheel","mouseover"],r=(e,t)=>t?function(t){return t.preventDefault=(()=>{}),e.call(this,t)}:e,n=n=>{EventTarget.prototype.addEventListener=function(o,s,i){const l="object"==typeof i,c=l?i.capture:i;(i=l?(e=>{const t=Object.getOwnPropertyDescriptor(e,"passive");return t&&!0!==t.writable&&void 0===t.set?Object.assign({},e):e})(i):{}).passive=((t,r)=>void 0!==t?t:-1!==a.indexOf(r)&&e)(i.passive,o),i.capture=void 0===c?t:c,s=r(s,i.passive),n.call(this,o,s,i)}};(()=>{let e=!1;try{const t=Object.defineProperty({},"passive",{get(){e=!0}});window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch(e){}return e})()&&n(EventTarget.prototype.addEventListener)},initDefaultBootboxConfig:()=>{d.setDefaults({onEscape:!0})},initDefaultTooltipConfig:t=>{e.fn.tooltip.Constructor.DEFAULTS.container=t,e.fn.tooltip.Constructor.DEFAULTS.delay=100},initDefaultPopoverConfig:t=>{e.fn.popover.Constructor.DEFAULTS.container=t},initDefaultConfirmationConfig:()=>{e.fn.confirmation.Constructor.DEFAULTS.placement="left",e.fn.confirmation.Constructor.DEFAULTS.container="body",e.fn.confirmation.Constructor.DEFAULTS.btnCancelClass="btn btn-sm btn-default",e.fn.confirmation.Constructor.DEFAULTS.btnCancelLabel="cancel",e.fn.confirmation.Constructor.DEFAULTS.btnCancelIcon="fas fa-fw fa-ban",e.fn.confirmation.Constructor.DEFAULTS.btnOkClass="btn btn-sm btn-danger",e.fn.confirmation.Constructor.DEFAULTS.btnOkLabel="delete",e.fn.confirmation.Constructor.DEFAULTS.btnOkIcon="fas fa-fw fa-times",e.fn.confirmation.Constructor.DEFAULTS.template=w()},initDefaultSelect2Config:()=>{e.fn.select2.defaults.set("theme","pathfinder"),e.fn.select2.defaults.set("language",{searching:e=>'&nbsp;<i class="fas fa-sync fa-spin"></i>&nbsp;&nbsp;searching...'}),e.fn.select2.defaults.set("escapeMarkup",e=>e);let t=t=>{t.css("maxHeight","300px"),e(t).find("ul.select2-results__options").off("mousewheel"),t.mCustomScrollbar({scrollInertia:200,mouseWheel:{enable:!0,scrollAmount:"auto",axis:"y",preventDefault:!0},keyboard:{enable:!1,scrollType:"stepless",scrollAmount:"auto"},scrollbarPosition:"inside",autoDraggerLength:!0,autoHideScrollbar:!1,alwaysShowScrollbar:0,advanced:{updateOnContentResize:!0},callbacks:{alwaysTriggerOffsets:!1,onTotalScrollOffset:100,onInit:function(){S(!1)},onUpdate:function(e){new c({container:this,elements_selector:`.${u.select2ImageLazyLoadClass}`,threshold:240,use_native:!0})},onTotalScroll:function(){let e=this.mcs.content.find(".select2-results__option--load-more");e.addClass("no-margin"),this.mcs.content.find("> :first-child").trigger("scroll"),setTimeout(()=>e.removeClass("no-margin"),20)}}})},a=t=>{let a=null;if(e(t).data("select2")){let r=e(t).data("select2").$results;if(r.length){let e=r.closest(".select2-results");e.length&&(a=e)}}return a};e(document).on("select2:open","."+u.select2Class,function(e){let r=a(this);r&&t(r)}),e(document).on("select2:closing","."+u.select2Class,function(t){let r=a(this);r&&r.mCustomScrollbar("destroy"),e(this).parents(".editableform").find(this).next().find(".select2-selection").remove(),S(!0)})},initDefaultEditableConfig:t=>{e.fn.editable.defaults.container=t,e.fn.editableform.buttons='<div class="btn-group"><button type="button" class="btn btn-default btn-sm editable-cancel"><i class="fa fa-fw fa-times"></i></button><button type="submit" class="btn btn-success btn-sm editable-submit"><i class="fa fa-fw fa-check"></i></button></div>',e.fn.editableform.loading='<div class="editableform-loading"><i class="fas fa-lg fa-sync fa-spin"></i></div>'},getCurrentTriggerDelay:(e,a)=>((void 0===t.timer[e].CURRENT_DELAY||t.timer[e].CURRENT_DELAY<=0)&&(t.timer[e].CURRENT_DELAY=t.timer[e].DELAY),a===parseInt(a,10)&&t.timer[e].CURRENT_DELAY+a>0&&(t.timer[e].CURRENT_DELAY+=a),t.timer[e].CURRENT_DELAY),getRandomString:I,getServerTime:()=>{let e=new Date;return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds())},convertTimestampToServerTime:e=>{let t=(new Date).getTimezoneOffset();return new Date(1e3*(e+60*t))},getTimeDiffParts:(e,t)=>{let a={},r=e.getTime(),n=t.getTime(),o=r>=0&&n>=0?(n-r)/1e3:0;o=Math.abs(Math.floor(o)),a.days=Math.floor(o/86400);let s=o-24*a.days*60*60;return a.hours=Math.floor(s/3600),s-=60*a.hours*60,a.min=Math.floor(s/60),a.sec=s-60*a.min,a},formatTimeParts:e=>{let t="";return e.days&&(t+=e.days+"d "),t+=("00"+e.hours).slice(-2),t+=":"+("00"+e.min).slice(-2)},timeStart:e=>{"object"==typeof performance?g[e]=performance.now():g[e]=(new Date).getTime()},timeStop:e=>{let t=0;if(g.hasOwnProperty(e)){let a=0;a="object"==typeof performance?performance.now():new Date,t=Number((a-g[e]).toFixed(2)),delete g[e]}return t},updateCounter:(e,t,a)=>{if(e.length){let r=e.val(),n=r.length,o=r.match(/(\r\n|\n|\r)/g),s=0;null!=o&&(s=o.length),n+=s,t.text(a-n),a<=n?t.toggleClass("txt-color-red",!0):t.toggleClass("txt-color-red",!1)}},log:(t,a)=>{e(window).trigger("pf:log",[t,a])},showNotify:D,stopTabBlink:k,getLogInfo:(e,a)=>{let r="";return t.classes.logTypes.hasOwnProperty(e)&&(r=t.classes.logTypes[e][a]),r},ajaxSetup:()=>{e.ajaxSetup({beforeSend:function(e,t){e.url=location.protocol+"//"+location.host+t.url,!1===t.crossDomain&&e.setRequestHeader("pf-character",O())},complete:function(t,a){((t=!0)=>{let a=e("#"+u.globalInfoPanelId);t&&!a.length?requirejs(["text!templates/ui/info_panel.html","mustache"],(t,a)=>{let r={id:u.globalInfoPanelId},n=e(a.render(t,r));e("#"+u.footerId).find("."+u.footerCenterClass).append(n)}):!t&&a.length&&a.remove()})(parseInt(t.getResponseHeader("pf-maintenance"))||0)}})},request:(a,r,n=[],o={},s={},i=null)=>{return new Promise((l,c)=>{let d={action:"request",name:a.toLowerCase()+r.capitalize()},p=t.path.api+"/"+r,u="";if(isNaN(n))Array.isArray(n)&&(u+="/"+n.join(","));else{let e=parseInt(n,10);u+=e?"/"+e:""}let f={type:a,url:p+=u,dataType:"json",context:s};"GET"===a?f.data=o:(f.data=JSON.stringify(o),f.contentType="application/json; charset=utf-8"),e.ajax(f).done(function(e){d.data=e,d.context=this,l(d)}).fail(function(e,t,a){d.data={jqXHR:e,status:t,error:a},d.context=this,c(d)}).always(function(){i&&i(this)})})},handleAjaxErrorResponse:e=>{if("request"!==e.action)return void console.error("Unhandled HTTP response error. Invalid payload %o",e);let t=e.data.jqXHR,a=`${t.status}: ${t.statusText} - ${e.name}`,r="";if(t.responseJSON){let a=t.responseJSON;a.error&&a.error.length>0&&(r=a.error.map(e=>e.text||e.status).join("\n"),e.context.formElement&&e.context.formElement.showFormMessage(a.error))}else r="Invalid JSON response";D({title:a,text:r,type:"error"})},setSyncStatus:F,getSyncType:()=>t.syncStatus.type,isXHRAborted:e=>!e.getAllResponseHeaders(),triggerMenuAction:(t,a,r)=>{t?"string"==typeof a&&a.length?e(t).trigger("pf:menuAction",[a,r]):console.error("Invalid action: %o",a):console.error("Invalid element: %o",t)},getLabelByRole:t=>e("<span>",{class:["label","label-"+t.style].join(" "),text:t.label}),getMapModule:()=>{let t=e("#"+u.mapModuleId);return 0===t.length&&(t=e("<div>",{id:u.mapModuleId})),t},getMapTabLinkElements:(e,t)=>{let a=`.${u.mapTabBarClass}  > li > a`;return t&&(a+=`[data-map-id="${t}"]`),e.querySelectorAll(a)},getMapTabContentAreaClass:e=>[u.mapTabContentAreaClass,u.mapTabContentAreaAliases.includes(e)?e:void 0].filter(Boolean).join("-"),getSystemEffectMultiplierByAreaId:e=>i.getMultiplierByAreaId(e),getSystemEffectData:(e,t)=>{let a=i;if(e){a=!1;let r=R(e);r>0&&i.wh[t]&&i.wh[t][r]&&(a=i.wh[t][r])}return a},getSystemEffectTable:e=>{let t="";if(e.length>0){t+="<table>";for(let a of e)t+="<tr>",t+="<td>",t+=a.effect,t+="</td>",t+='<td class="text-right">',t+=a.value,t+="</td>",t+="</tr>";t+="</table>"}return t},getSystemPlanetsTable:e=>{let t="";if(e.length>0){let a=/\(([^)]+)\)/;t+="<table>";for(let r of e){let e=r.type.name,n="",o=a.exec(e.toLowerCase());o&&o[1]&&(e=o[1].capitalize(),n=N(o[1])),t+="<tr>",t+="<td>",t+=r.name,t+="</td>",t+='<td class="'+n+'">',t+='<i class="fas fa-circle"></i>',t+="</td>",t+='<td class="text-right">',t+=e,t+="</td>",t+="</tr>"}t+="</table>"}return t},getSystemSovereigntyTable:e=>{let t=[];e&&(e.faction&&t.push({label:"Faction",value:e.faction.name}),e.alliance&&t.push({label:"Alliance",value:e.alliance.name}));let a="<table>";for(let e of t)a+="<tr>",a+="<td>",a+=e.label,a+="</td>",a+='<td class="text-right">',a+=e.value,a+="</td>",a+="</tr>";return a+="</table>"},getSystemPilotsTable:e=>{let t="";if(e.length>0){let a=(e,t,a,r,n)=>{let o="<tr>";return o+='<td class="text-right">',o+="<small>",o+=null!==e?'<i class="fas fa-circle '+u.userStatusClass+" "+e+'">':"",o+="</small>",o+="</td>",o+="<td>",o+=t,o+="</td>",o+="<td>",o+=C(a),o+="</td>",o+='<td class="text-right txt-color txt-color-orangeLight">',o+=r,o+="</td>",o+='<td class="text-right">',o+=n,o+="</td>",o+="</tr>"},r=0;t+="<table>";for(let n of e){r+=parseInt(n.log.ship.mass);let e=H(n,"class"),o=X(n.log.ship.mass);t+=a(e,n.name,n.log.ship.name,n.log.ship.typeName,o)}t+=a(null,"","","",X(r)),t+="</table>"}return t},getSystemsInfoTable:e=>{let t="";if(e.length>0){t+="<table>";for(let a=0;a<e.length;a++){let r=B(e[a].trueSec),n=_(e[a].security);t+="<tr>",t+="<td>",t+=e[a].name,t+="</td>",t+='<td class="text-right '+n+'">',t+=e[a].security,t+="</td>",t+='<td class="text-right '+r+'">',t+=parseFloat(e[a].trueSec).toFixed(1),t+="</td>",t+="</tr>"}t+="</table>"}return t},getStatusInfoForCharacter:H,getSecurityClassForSystem:_,getTrueSecClassForSystem:B,getStatusInfoForSystem:(a,r)=>{let n="";return t.systemStatus.hasOwnProperty(a)?n=t.systemStatus[a][r]:e.each(t.systemStatus,function(e,t){a!==t.id||(n=t[r])}),n},getSignatureGroupOptions:e=>{let a=[];for(let[r,n]of Object.entries(t.signatureGroups))a.push({value:parseInt(r),text:n[e]});return a},getSignatureTypeNames:(e,t,a)=>Q(...t.map(t=>Z(l,[e,t,a].join("."))||{})),getAreaIdBySecurity:R,setCurrentMapUserData:e=>(t.currentMapUserData=e,V()),getCurrentMapUserData:V,updateCurrentMapUserData:e=>{let a=(e=>z(t.currentMapUserData,e))(e.config.id);Array.isArray(t.currentMapUserData)||(t.currentMapUserData=[]),!1!==a?t.currentMapUserData[a]=e:t.currentMapUserData.push(e)},setCurrentMapData:e=>(t.currentMapData=e,$()),getCurrentMapData:$,filterCurrentMapData:(e,t)=>{let a=$();return a&&(a=a.filter(a=>Z(a,e)===t)),a},updateCurrentMapData:e=>{let a=(e=>z(t.currentMapData,e))(e.config.id);!1!==a?(t.currentMapData[a].config=e.config,t.currentMapData[a].data=e.data):t.currentMapData.push(e)},deleteCurrentMapData:e=>{t.currentMapData=t.currentMapData.filter(t=>t.config.id!==e)},setCurrentUserData:a=>{let r=!1;if(a&&a.character&&a.characters){let n=L(M(),a);t.currentUserData=a,r=!0,Object.values(n).some(e=>e)&&e(document).trigger("pf:changedUserData",[n])}else console.error("Could not set userData %o. Missing or malformed obj",a);return r},getCurrentUserData:M,getCurrentCharacter:j,getCurrentCharacterData:E,getCurrentCharacterId:O,setCurrentSystemData:(e,t)=>{(e=parseInt(e)||0)&&"object"==typeof t?f.set(`mapId_${e}`,t):console.error("Invalid mapId %o or systemData %o")},getCurrentSystemData:e=>{if(e=parseInt(e)||0)return f.get(`mapId_${e}`);console.error("Invalid mapId %o")},deleteCurrentSystemData:e=>{if(e=parseInt(e)||0)return f.delete(`mapId_${e}`);console.error("Invalid mapId %o")},getCurrentLocationData:()=>{let t=e("#"+u.headUserLocationId+">li:last-of-type");return{id:parseInt(t.attr("data-systemId"))||0,name:t.attr("data-systemName")||!1}},getCurrentUserInfo:U,findInViewport:e=>{let t=[];for(let a of e){if(!(a instanceof HTMLElement)){console.warn("findInViewport() expects Array() of %O; %o given",HTMLElement,a);continue}let e=a.offsetTop,r=a.offsetLeft,n=a.offsetWidth,o=a.offsetHeight,s=a;for(;a.offsetParent;)e+=(a=a.offsetParent).offsetTop,r+=a.offsetLeft;e<window.pageYOffset+window.innerHeight&&r<window.pageXOffset+window.innerWidth&&e+o>window.pageYOffset&&r+n>window.pageXOffset&&t.push(s)}return t},initScrollSpy:(t,a=document,r={})=>{let n,o,s;if(r=Object.assign({},{clsOnScroll:"on-scroll"},r),!t)return void console.warn("initScrollSpy() failed. navElement undefined");let i=()=>a===document?document.body:a,l=Array.from(t.querySelectorAll(".page-scroll")).map(e=>({link:e,content:document.getElementById(e.getAttribute("data-target"))})),c=e=>{if(!e)return;document.activeElement===e.link&&document.activeElement.blur();let t=e.link.closest("li");t&&t.classList.remove("active")},d=(e,t,a)=>{let r=e.getBoundingClientRect(),n=(e=>"function"==typeof e.offset?parseFloat(e.offset()):parseFloat(e.offset))(t);return a?parseInt(r.bottom,10)<(window.innerHeight||document.documentElement.clientHeight):parseInt(r.top,10)<=n},p=()=>window.innerHeight+window.pageYOffset>=(()=>Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight))(),u=(e,t)=>{let a=e[e.length-1];if(((e,t)=>!(!p()||!d(e.content,t,!0)))(a,t))return a;for(let a=e.length-1;a>=0;a--)if(d(e[a].content,t))return e[a]},f=()=>{let e=u(l,r);e?s&&e.content===s.content||(c(s),(e=>{if(!e)return;let t=e.link.closest("li");t&&t.classList.add("active")})(e),s=e):s&&(c(s),s=null)};f(),a.addEventListener("scroll",()=>{n&&window.cancelAnimationFrame(n),n=window.requestAnimationFrame(()=>{f(),o&&clearTimeout(o),i().classList.add(r.clsOnScroll),o=setTimeout(()=>i().classList.remove(r.clsOnScroll),80)})},{passive:!0});let m=function(e){e.preventDefault(),this.content.scrollIntoView({behavior:"smooth"})};for(let t of l)e(t.link).on("click",m.bind(t))},getConfirmationTemplate:w,getConfirmationContent:e=>{let t="";return t+=(e=>{let t='<form class="form-inline editableform popover-content-inner">';t+='<div class="control-group form-group">',t+='<div class="editable-input">',t+='<div class="editable-checklist">';for(let a of e)t+="<div><label>",t+='<input type="checkbox" name="'+a.name+'" value="'+a.value+'" ',t+='class="'+a.class+'" '+(a.checked?"checked":"")+">",t+="<span>"+a.label+"</span>",t+="</label></div>";return t+="</div>",t+="</div>",t+="</div>",t+="</form>"})(e)},convertXEditableOptionsToSelect2:e=>{let t=[];if(e.options){let a=e.options.prepend?e.options.prepend:[],r=e.options.source(),n=[];n.push(...a,...r);let o=t=>{let a={id:t.value,text:t.text};return e.value===t.value&&(a.selected=!0),!0===t.disabled&&(a.disabled=!0),t.hasOwnProperty("metaData")&&(a.metaData=t.metaData),a};t=n.map(e=>(e.children?e.children=e.children.map(o):e=o(e),e))}return t},flattenXEditableSelectArray:e=>{let t={};for(let a of e)if(a.children&&a.children.length>0)for(let e of a.children)t[e.value]=e.text;else t[a.value]=a.text;return t},getCharacterDataBySystemId:W,getNearBySystemData:q,getNearByCharacterData:Y,setDestination:(a,r,n)=>{let o="";switch(a){case"set_destination":o="Set destination";break;case"add_first_waypoint":o="Set first waypoint";break;case"add_last_waypoint":o="Set new waypoint"}e.ajax({type:"POST",url:t.path.setDestination,data:{clearOtherWaypoints:"set_destination"===a?1:0,first:"add_last_waypoint"===a?0:1,destData:[n]},context:{destType:r,description:o},dataType:"json"}).done(function(e){if(e.destData&&e.destData.length>0)for(let t=0;t<e.destData.length;t++)D({title:this.description,text:this.destType+": "+e.destData[t].name,type:"success"});if(e.error&&e.error.length>0)for(let t=0;t<e.error.length;t++)D({title:this.description+" error",text:this.destType+": "+e.error[t].message,type:"error"})}).fail(function(e,t,a){let r=t+" "+a;D({title:e.status+": "+this.description,text:r,type:"warning"})})},copyToClipboard:e=>{return new Promise((t,a)=>{let r={action:"copyToClipboard",data:!1};navigator.clipboard?navigator.permissions.query({name:"clipboard-write"}).then(a=>{"granted"===a.state||"prompt"===a.state?navigator.clipboard.writeText(e).then(()=>{r.data=!0,t(r)}).catch(e=>{let a="Failed to write clipboard content";console.error(a,e),D({title:"Clipboard API",text:a,type:"error"}),t(r)}):(D({title:"Clipboard API",text:"You denied write access",type:"warning"}),t(r))}):(console.warn("Clipboard API not supported by your browser"),t(r))})},readFromClipboard:()=>{return new Promise((e,t)=>{let a={action:"readFromClipboard",data:!1};navigator.clipboard?navigator.permissions.query({name:"clipboard-read"}).then(t=>{"granted"===t.state||"prompt"===t.state?navigator.clipboard.readText().then(t=>{a.data=t,e(a)}).catch(t=>{let r="Failed to read clipboard content";console.error(r,t),D({title:"Clipboard API",text:r,type:"error"}),e(a)}):(D({title:"Clipboard API",text:"You denied read access",type:"warning"}),e(a))}):(console.warn("Clipboard API not supported by your browser"),e(a))})},convertDateToUTC:G,convertDateToString:J,getOpenDialogs:()=>e("."+u.dialogClass).filter(":visible"),openIngameWindow:a=>{(a=parseInt(a))>0&&e.ajax({type:"POST",url:t.path.openIngameWindow,data:{targetId:a},dataType:"json"}).done(function(e){e.error.length>0?D({title:"Open window in client",text:"Remote window open failed",type:"error"}):D({title:"Open window in client",text:"Check your EVE client",type:"success"})}).fail(function(e,t,a){let r=t+" "+a;D({title:e.status+": openWindow",text:r,type:"error"})})},formatPrice:e=>{let t=(e=Number(e).toFixed(2)).toString().split(".");return(e=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,",")+(t[1]?"."+t[1]:""))+" ISK"},formatMassValue:X,getLocalStore:e=>{if(u.localStoreNames.includes(e))return o.getStore(e);throw new RangeError("Invalid LocalStore name. Allowed names: "+u.localStoreNames.join("|"))},getResizeManager:()=>s,clearSessionStorage:()=>{sessionStorage&&sessionStorage.clear()},hasRight:(e,t)=>{let a=!1,r=(E(`${t}.rights`)||[]).find(t=>t.right.name===e);if(r){let e=E("role");"SUPER"!==e.name&&"MEMBER"!==r.role.name&&r.role.name!==e.name||(a=!0)}return a},getBrowserTabId:A,singleDoubleClick:(e,a,r,n=t.timer.DBL_CLICK)=>{e.addEventListener("click",t=>{if(1===t.detail){let e=setTimeout(e=>{a.call(e,t),e.removeData("clickTimeoutId")},n,t.currentTarget);t.currentTarget.setData("clickTimeoutId",e)}else 2===t.detail&&(r.call(e,t),clearTimeout(t.currentTarget.getData("clickTimeoutId")),t.currentTarget.removeData("clickTimeoutId"))})},getTableId:K,getTableRowId:(e,t,a)=>e+[t,a].join("-"),getDataTableInstance:(t,a,r,n)=>{let o=null,s=e.fn.dataTable.tables({visible:!1,api:!0}).table("#"+K(t,n,a,r));return s.node()&&(o=s),o},htmlEncode:t=>e("<div>").text(t).html(),htmlDecode:t=>e("<div>").html(t).text(),isValidHtml:e=>{let t=(new DOMParser).parseFromString(e,"text/html");return Array.from(t.body.childNodes).some(e=>1===e.nodeType)},isDomElement:e=>!(!e||1!==e.nodeType),arrayToObject:(e,t="id")=>e.reduce((e,a)=>(e[a[t]]=a,e),{}),filterObjByKeys:(e,t=[])=>Object.keys(e).filter(e=>t.includes(e)).reduce((t,a)=>(t[a]=e[a],t),{}),getObjVal:Z,redirect:ee,logout:a=>{let r=Z(a,"ajaxData")||{};e.ajax({type:"POST",url:t.path.logout,data:r,dataType:"json"}).done(function(e){if(e.reroute){let t=r.graceful?"logoutGraceful":"logout";ee(e.reroute,[t])}}).fail(function(e,t,a){let r=t+" "+a;D({title:e.status+": logout",text:r,type:"error"})})},setCookie:(e,t,a,r)=>{let n=new Date,o=n.getTime(),s=-1*o;if(a>0)switch(r){case"d":s=24*a*60*60*1e3;break;case"s":s=1e3*a}n.setTime(o+s);let i="expires="+n.toUTCString(),l="path="+(window.location.pathname.replace(/[^\/]*$/,"")||"/");document.cookie=e+"="+t+"; "+i+"; "+l},getCookie:e=>{let t=e+"=",a=document.cookie.split(";");for(let e=0;e<a.length;e++){let r=a[e];for(;" "===r.charAt(0);)r=r.substring(1);if(0===r.indexOf(t))return r.substring(t.length,r.length)}return""}}});
//# sourceMappingURL=util.js.map
