define(["jquery","app/init","app/util","app/map/util","app/map/overlay/util"],function(a,e,l,t,s){"use strict";let o={overlayClass:"pf-map-overlay",overlayLocalClass:"pf-map-overlay-local",overlayLocalContentClass:"pf-map-overlay-local-content",overlayLocalHeadlineClass:"pf-map-overlay-headline",overlayLocalTableClass:"pf-local-table",overlayLocalTriggerClass:"pf-map-overlay-local-trigger",overlayLocalOpenClass:"pf-map-overlay-local-open",overlayLocalMainClass:"pf-map-overlay-local-main",overlayLocalUsersClass:"pf-map-overlay-local-users",overlayLocalJumpsClass:"pf-map-overlay-local-jumps",tableCellImageClass:"pf-table-image-cell",tableCellActionClass:"pf-table-action-cell",tableCellActionIconClass:"pf-table-action-icon-cell",toolbarClass:"pf-map-overlay-toolbar",toolbarIconClass:"pf-map-overlay-toolbar-icon",toolbarCheckboxClass:"pf-map-overlay-toolbar-checkbox"},i=a=>a.hasClass(o.overlayLocalOpenClass),n=a=>{if(!i(a)){a.find("."+o.overlayLocalMainClass).find("."+o.overlayLocalTriggerClass).addClass("right"),a.addClass(o.overlayLocalOpenClass),a.velocity({width:"350px"},{duration:e.animationSpeed.mapOverlayLocal,easing:"easeOut"})}},r=(t,s)=>{let r=t.find("."+o.overlayLocalMainClass);r.on("click",function(){let r=a(this).parent("."+o.overlayLocalClass),c=i(r);l.getLocalStore("map").setItem(`${s}.showLocal`,!c),c?(a=>{i(a)&&(a.find("."+o.overlayLocalMainClass).find("."+o.overlayLocalTriggerClass).removeClass("right"),a.removeClass(o.overlayLocalOpenClass),a.velocity({width:"32px"},{duration:e.animationSpeed.mapOverlayLocal,easing:"easeOut"}))})(t):n(t)}),t.closest("."+l.getMapTabContentAreaClass("map")).on("pf:mapResize",function(a){t.find("."+o.overlayLocalTableClass).DataTable().draw("full-hold")}),r.initTooltips({placement:"bottom"})},c=(a,e="id",l=[],t=!0)=>a.rows().eq(0).filter(function(s){let o=-1!==l.indexOf(a.row(s).data()[e]);return t||(o=!o),o}),p=(a,e,t=0,s=0)=>{let i=a.find("."+o.overlayLocalHeadlineClass),n=a.find("."+o.overlayLocalUsersClass),r=l.getSecurityClassForSystem("security"),c=l.getSecurityClassForSystem(e.security),p=i.children("span");p.eq(1).removeClass().addClass([r,c].join(" ")).text(e.security),p.eq(2).text(e.alias?e.alias:e.name),t>0?n.toggleClass("txt-color-green",!0).toggleClass("txt-color-red",!1):n.toggleClass("txt-color-green",!1).toggleClass("txt-color-red",!0),n.text(t),s>0?p.eq(3).toggleClass("txt-color-green",!0).toggleClass("txt-color-red",!1):p.eq(3).toggleClass("txt-color-green",!1).toggleClass("txt-color-red",!0),p.eq(3).text(s)};a.fn.updateLocalTable=function(e,t){return this.each(function(){let s=a(this),r=s.find("."+o.overlayLocalTableClass).DataTable(),d=e.mapId,g=[],f=[];for(let a in t)if(t.hasOwnProperty(a)){a=parseInt(a);for(let e=0;e<t[a].length;e++){t[a][e].jumps=a;let l=t[a][e],s=c(r,"id",[l.id]);if(s.length>0){let a=r.row(parseInt(s[0]));a.nodes().to$().find("[title]").tooltip("hide").tooltip("destroy"),a.data(l)}else r.row.add(l);0===a&&f.push(l.id),g.push(l.id)}}let C=c(r,"id",g,!1);r.rows(C).remove(),r.draw("full-hold"),p(s,e,g.length,f.length),i(s)||l.getLocalStore("map").getItem(d).then(a=>{a&&a.showLocal&&n(s)})})};let d=(e,t,s="")=>{a(t).hover(function(o){let i=e.cell(t).index().row,n=e.row(i).data();a(this).tooltip({container:"body",title:l.getObjVal(n,s),placement:"left",delay:100}).tooltip("show")},function(e){a(this).tooltip("hide")})};a.fn.initLocalOverlay=function(e){a(this).each(function(){let i=a(this),n=a("<div>",{class:[o.overlayClass,o.overlayLocalClass].join(" ")}),c=a("<div>",{class:["text-right",o.overlayLocalContentClass].join(" ")}),p=a("<table>",{class:["compact","order-column",o.overlayLocalTableClass].join(" ")}),g=a("<div>",{text:"",class:o.overlayLocalMainClass}).append(a("<i>",{class:["fas","fa-chevron-down","fa-fw","pf-animate-rotate",o.overlayLocalTriggerClass].join(" ")}),a("<span>",{class:["badge","txt-color","txt-color-red",o.overlayLocalUsersClass].join(" "),text:0}),a("<div>",{class:o.overlayLocalJumpsClass}).append(a("<span>",{class:["badge","txt-color","txt-color-grayLight"].join(" "),text:t.config.defaultLocalJumpRadius}).attr("title","jumps"))),f=a("<div>",{class:o.overlayLocalHeadlineClass}).append(a("<span>",{html:"Nearby&nbsp;&nbsp;&nbsp;",class:"pull-left"}),a("<span>"),a("<span>"),a("<span>",{class:["badge"," txt-color","txt-color-red"].join(" "),text:0}));c.append(f),c.append(p),n.append(g),n.append(c),i.append(n),r(n,e),p.on("preDraw.dt",function(e,t){let o=a(this),i=o.closest("."+l.getMapTabContentAreaClass("map"));if(i&&i.length){let a=i[0].offsetHeight,e=s.getMapOverlay(o,"local"),l=e.find(".dataTables_paginate"),t=o.DataTable(),n=t.page.info(),r=26,c=e[0].offsetTop,p=48,d=a-(p+=26)-c-53,g=Math.floor(d/r);n.recordsDisplay>g&&(d-=30,g=Math.floor(d/r)),n.length!==g&&(t.page.len(g),(n=t.page.info()).pages<=1?l.hide():l.show())}}),p.on("draw.dt",function(e,l){a(this).find("td").initTooltips({placement:"left"})}),p.on("init.dt",function(){a(this).initTooltips({placement:"top"})});p.DataTable({pageLength:3,paging:!0,pagingType:"simple",lengthChange:!1,ordering:!0,order:[0,"asc"],info:!1,searching:!1,hover:!1,responsive:!1,rowId:function(a){return"pf-local-row_"+a.id},language:{emptyTable:"<span>You&nbsp;are&nbsp;alone</span>",paginate:{next:"&nbsp;",previous:"&nbsp;"}},columnDefs:[{targets:0,orderable:!0,title:'<span title="jumps" data-toggle="tooltip">&nbsp;</span>',width:"1px",className:[l.config.helpDefaultClass,"text-center"].join(" "),data:"jumps",render:{_:(a,e,l,t)=>{let s=a;return"display"===e&&0===s&&(s='<i class="fas fa-map-marker-alt"></i>'),s}},createdCell:function(a,e,l,t,s){let o=this.DataTable();d(o,a,"log.system.name")}},{targets:1,orderable:!1,title:"",width:"26px",className:[l.config.helpDefaultClass,"text-center",o.tableCellImageClass].join(" "),data:"log.ship",render:{_:(a,e,t,s)=>{let o=a.typeName;return"display"===e&&(o='<img src="'+l.eveImageUrl("types",a.typeId)+'"/>'),o}},createdCell:function(a,e,l,t,s){let o=this.DataTable();d(o,a,"log.ship.typeName")}},{targets:2,orderable:!0,title:"ship&nbsp;name",width:"80px",data:"log.ship",render:{_:(a,e,l,s)=>{let o=a.name;return"display"===e&&(o='<div class="'+t.config.tableCellEllipsisClass+" "+t.config.tableCellEllipsis80Class+'">'+a.name+"</div>"),o},sort:"name"}},{targets:3,orderable:!0,title:"pilot",data:"name",render:{_:(a,e,l,s)=>{let o=a;return"display"===e&&(o='<div class="'+t.config.tableCellEllipsisClass+" "+t.config.tableCellEllipsis90Class+'">'+a+"</div>"),o}}},{targets:4,orderable:!1,title:"",width:"10px",className:[l.config.helpDefaultClass].join(" "),data:"log",render:{_:(a,e,l,t)=>{let s="";return"display"===e&&(a.station&&a.station.id>0?s='<i class="fas fa-home"></i>':a.structure&&a.structure.id>0&&(s='<i class="fas fa-industry"></i>')),s}},createdCell:function(a,e,l,t,s){let o="";e.station&&e.station.id>0?o="log.station.name":e.structure&&e.structure.id>0&&(o="log.structure.name");let i=this.DataTable();d(i,a,o)}},{targets:5,orderable:!1,title:'<i title="open ingame" data-toggle="tooltip" class="fas fa-id-card text-right"></i>',width:"10px",className:[o.tableCellActionClass].join(" "),data:"id",render:{_:(a,e,l,t)=>{let s=a;return"display"===e&&(s='<i class="fas fa-id-card '+o.tableCellActionIconClass+'"></i>'),s}},createdCell:function(e,t,s,o,i){a(e).on("click",{tableApi:this.DataTable(),cellData:t},function(a){a.data.tableApi.cell(this).data();l.openIngameWindow(a.data.cellData)})}}]})})};a.fn.clearLocalTable=function(e){return this.each(function(){let e=a(this);p(e,{name:"unknown",security:""}),e.find("."+o.overlayLocalTableClass).DataTable().rows().remove().draw()})}});
//# sourceMappingURL=local.js.map
