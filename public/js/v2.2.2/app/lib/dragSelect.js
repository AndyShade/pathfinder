define(["app/lib/eventHandler"],t=>{"use strict";let e=class DragSelect{constructor(t){this._config=Object.assign({},this.constructor.defaultConfig,t),this._instanceId=++this.constructor.instanceCount,this._instanceName=[this._config.namespace,this._instanceId].join("-"),this._animationFrameId=null,this._mouseIsDown=!1,this._cursorPosition={x:0,y:0},this._selectBoxDimHash=void 0,this._deselectedElements=[],this._targetDim={left:0,top:0,width:10,height:10},this._selectBoxOrigin={left:0,top:0},this.init(),this.debug=((t,...e)=>{this._config.debug&&(e=e||[],console.debug(t,...e))}),this.debugEvent=(t=>{if(this._config.debugEvents){let e="?";switch(t.type){case"mousedown":e="⯆";break;case"mousemove":e="⯈";break;case"mouseup":e="⯅"}this.debug("ON "+e+" %s currentTarget: %o event: %o",t.type,t.currentTarget,t)}})}setTargetDimensions(){let t=this._config.target.getBoundingClientRect();Object.assign(this._targetDim,this.filterDomRect(t))}setBoundaryDimensions(){if(this._config.boundary){let t=this._config.target.closest(this._config.boundary);if(t)return this._boundaryDim=t.getBoundingClientRect()}delete this._boundaryDim}setCursorPosition(t){Object.assign(this._cursorPosition,{x:t.pageX,y:t.pageY})}init(){this.initSelectBox(),this.setTargetDimensions(),t.addEventListener(this._config.target,this.getNamespaceEvent("mousedown"),this.onMouseDown.bind(this),{passive:!1}),t.addEventListener(this._config.container,this.getNamespaceEvent("mousemove"),this.onMouseMove.bind(this),{passive:!0}),t.addEventListener(this._config.container,this.getNamespaceEvent("mouseup"),this.onMouseUp.bind(this),{passive:!0})}onMouseDown(t){1===t.which&&(this.debugEvent(t),this.setTargetDimensions(),this.showSelectBox(t),this._mouseIsDown=!0)}onMouseMove(t){this._mouseIsDown&&(t.preventDefault(),t.stopPropagation(),this._animationFrameId&&cancelAnimationFrame(this._animationFrameId),this._animationFrameId=requestAnimationFrame(()=>{this.debugEvent(t),this.setCursorPosition(t),this.update(),this._animationFrameId=null}))}onMouseUp(t){this.debugEvent(t),this.selectElements(),this.hideSelectBox(),this._mouseIsDown=!1,this._deselectedElements=[]}initSelectBox(){this._selectBox=document.createElement("div"),this._selectBox.id=this._instanceName,this._selectBox.classList.add(this._config.selectBoxClass),this._config.target.after(this._selectBox)}showSelectBox(t){Object.assign(this._selectBoxOrigin,{left:t.pageX-this._targetDim.left,top:t.pageY-this._targetDim.top}),this._selectBox.style.cssText=`--selectBox-left: ${this._selectBoxOrigin.left}px; `+`--selectBox-top: ${this._selectBoxOrigin.top}px; `+"--selectBox-width: 1px; --selectBox-height: 1px;",this._selectBox.classList.add(this._config.activeClass),this.callback("onShow")}updateSelectBox(){let t=!1;if(!this.isActiveSelectBox())return t;let e=this._cursorPosition.x-this._targetDim.left,s=this._cursorPosition.y-this._targetDim.top,i=this._selectBoxOrigin.left-e,o=this._selectBoxOrigin.top-s,n=this._selectBoxOrigin.left,c=this._selectBoxOrigin.top,h=e-this._selectBoxOrigin.left,l=s-this._selectBoxOrigin.top;h<0&&(n-=i,h*=-1),l<0&&(c-=o,l*=-1);let a=[h,l].join("_");return this._selectBoxDimHash!==a&&(this._selectBoxDimHash=a,this._selectBox.style.cssText=`--selectBox-left: ${n}px; `+`--selectBox-top: ${c}px; `+`--selectBox-width: ${h}px; `+`--selectBox-height: ${l}px;`,this._selectBox.dataset.origin=this.getSelectBoxDragOrigin(e,s,n,c).join("|"),t=!0,this.callback("onUpdate"),this.dispatch(this._selectBox,"update",this)),t}hideSelectBox(){this.isActiveSelectBox()&&!1!==this.callback("onHide",this._deselectedElements)&&this._selectBox.classList.remove(this._config.activeClass)}getSelectBoxDragOrigin(t,e,s,i){let o=[];return o=t===s&&e===i?["top","left"]:e===i?["top","right"]:t===s?["bottom","left"]:["bottom","right"]}isActiveSelectBox(){return this._selectBox.classList.contains(this._config.activeClass)&&!this._config.target.classList.contains(this._config.disabledClass)}selectableElements(){return this._config.target.querySelectorAll(this._config.selectables)}selectElements(){if(!this.isActiveSelectBox())return;let t=this.selectableElements(),e=this.filterDomRect(this._selectBox.getBoundingClientRect());t.forEach(t=>{let s=this.filterDomRect(t.getBoundingClientRect());this.percentCovered(e,s)>this._config.percentCovered?(t.classList.add(this._config.selectedClass),this._deselectedElements=this._deselectedElements.filter(e=>e!==t)):t.classList.contains(this._config.selectedClass)&&(t.classList.remove(this._config.selectedClass),-1===this._deselectedElements.findIndex(e=>e===t)&&this._deselectedElements.push(t))})}percentCovered(t,e){if(t.left<=e.left&&t.top<=e.top&&t.left+t.width>=e.left+e.width&&t.top+t.height>e.top+e.height)return 100;{t.right=t.left+t.width,t.bottom=t.top+t.height,e.right=e.left+e.width,e.bottom=e.top+e.height;let s=Math.max(t.left,e.left),i=Math.min(t.right,e.right),o=Math.max(t.top,e.top),n=Math.min(t.bottom,e.bottom);if(n>=o&&i>=s)return(i-s)*(n-o)/(e.width*e.height)*100}return 0}getIntersection(){let t=[];if(this.isActiveSelectBox&&this._boundaryDim){let e=this._selectBox.getBoundingClientRect();this._boundaryDim.top>e.top&&t.push("top"),this._boundaryDim.bottom<e.bottom&&t.push("bottom"),this._boundaryDim.left>e.left&&t.push("left"),this._boundaryDim.right<e.right&&t.push("right")}return t}update(){this.setTargetDimensions(),this.setBoundaryDimensions(),this.updateSelectBox()&&this._config.selectOnDrag&&this.selectElements()}getNamespaceEvent(t){return[t,this._instanceName].join(".")}filterDomRect(t,e=["left","top","width","height"]){let s={};return e.forEach(e=>{void 0!==t[e]&&(s[e]=t[e])}),s}callback(t,...e){if(this._config[t]instanceof Function)return this._config[t](...e)}dispatch(t,e,s=null){let i=new CustomEvent([e,this._config.namespace].join(":"),{bubbles:!0,detail:s});t.dispatchEvent(i)}};return e.defaultConfig={container:document,target:document.body,namespace:"dragSelect",activeClass:"active",disabledClass:"disabled",selectables:"div",selectedClass:"dragSelect-selected",selectBoxClass:"dragSelect-selectBox",boundary:void 0,selectOnDrag:!0,percentCovered:25,onShow:void 0,onHide:void 0,onUpdate:void 0,debug:!1,debugEvents:!1},e.instanceCount=0,e});
//# sourceMappingURL=dragSelect.js.map
