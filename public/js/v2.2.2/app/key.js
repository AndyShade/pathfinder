define(["jquery"],e=>{"use strict";let t={tabReload:{group:"global",label:"Close open dialog",keyNames:["ESC"]},mapMove:{group:"map",label:"Move map section",keyNames:["space","drag"]},signatureSelect:{group:"signatures",label:"Select multiple rows",keyNames:["CONTROL","CLICK"]},signatureNavigate:{group:"signatures",label:"Table navigation",keyNames:["UP","RIGHT","DOWN","LEFT"],list:!0}},a={tabReload:{group:"global",label:"Reload tab",keyNames:["CONTROL","R"]},clipboardPaste:{group:"global",label:"Update signatures/D-Scan from clipboard",keyNames:["CONTROL","V"],alias:"paste"},renameSystem:{group:"map",label:"Rename system",keyNames:["ALT","N"]},newSignature:{group:"signatures",label:"New Signature",keyNames:["ALT","3"]},mapSystemAdd:{group:"map",label:"New system",keyNames:["ALT","2"]},mapSystemsSelect:{group:"map",label:"Select all systems",keyNames:["CONTROL","A"]},mapSystemsDelete:{group:"map",label:"Delete selected systems",keyNames:["CONTROL","D"]}},l={global:{label:"Global"},map:{label:"Map"},signatures:{label:"Signature"}},s=!1,r={},n=(e,t)=>{0},o=function(e,t,a){return this.find(t=>t===e)},i=(e,t)=>{t=t||(()=>{let e=[];for(let t in a)e.push(t);return e})();let l=[];for(let s of t)a[s].keyNames.every(o,e)&&e.every(o,a[s].keyNames)&&l.push(s);return l},u=()=>{if(!s){let t=[],l=l=>{let s=0,u=(()=>Object.keys(r))();if(n(),u.length){let t=(e=>{let t=[];for(let l in a)e.every(o,a[l].keyNames)&&t.push(l);return t})(u);if(t.length){s=2;let r=i(u,t);r.length&&(s=3,r.forEach(t=>{a[t].alias?s=4:a[t].elements&&a[t].elements.forEach(a=>{let r=e(a);if(!r.data("key-focus-"+t)||document.activeElement===a){let e=r.data("key-callback-"+t);"function"==typeof e&&(s=5,e.call(a,a,l))}})}))}else s=1}return t=u,s},u=e=>{if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&!e.target.classList.contains("note-editable")){let t=e.key.toUpperCase();r[t]=!0;let a=l(e);2!==a&&3!==a&&5!==a||e.preventDefault()}},m=e=>{if(e.key){let t=e.key.toUpperCase();r.hasOwnProperty(t)&&delete r[t]}},p=e("body");p.on("keydown",u),p.on("keyup",m),new MutationObserver(e=>{e.forEach(e=>{if("childList"===e.type)for(let t=0;t<e.removedNodes.length;t++){let l=e.removedNodes[t];if("function"==typeof l.getAttribute){let e=l.getAttribute("key-events");if(e){let s=e.split(",");for(let e=0;t<s.length;e++){let t=s[e],r=a[t].elements.indexOf(l);r>-1&&a[t].elements.splice(r,1)}}}}})}).observe(document.body,{childList:!0,subtree:!0}),s=!0}};e.fn.watchKey=function(t,l,s){let r=e.extend(!0,{},{focus:!1,bubbling:!0},s);return this.each((s,o)=>{let i=e(o);u();let m=!1;if(a[t].elements?-1===a[t].elements.indexOf(o)?m=!0:console.warn('Event "'+t+'" already set'):(m=!0,a[t].elements=[]),m){if(r.focus){let e="key-focus-"+t;i.data(e,!0),o.hasAttribute("tabindex")||o.setAttribute("tabindex",0),i.off("click.focusKeyWatcher").on("click.focusKeyWatcher",function(e){(e.target===this||r.bubbling)&&(this.focus(),n())})}if(a[t].alias)i.on(a[t].alias,l);else{let e="key-callback-"+t;i.data(e,l)}let e=i.attr("key-events")?i.attr("key-events").split(","):[];e.push(t),i.attr("key-events",e.join(",")),a[t].elements.push(o),n()}})};return{isActive:e=>r.hasOwnProperty(e)&&!0===r[e],getGroupedShortcuts:()=>{let s=e.extend(!0,{},l),r=[t,a];for(let e of r)for(let[t,a]of Object.entries(e)){let e=a.keyNames.map(e=>("CONTROL"===e&&(e="ctrl"),e)),t={label:a.label,keyNames:e,list:a.list};s[a.group].events?s[a.group].events.push(t):s[a.group].events=[t]}return s=Object.values(s)}}});
//# sourceMappingURL=key.js.map
