"use strict";(t=>{window.NonBlockJs={NonBlock:t},document.body?window.NonBlockJs.nonBlock=new t(document.body):document.addEventListener("DOMContentLoaded",()=>{window.NonBlockJs.nonBlock=new t(document.body)})})((()=>{return class NonBlock{constructor(t,e){this.root=t;const o=window.getComputedStyle(document.body);this.pointerEventsSupport=o.pointerEvents&&"auto"===o.pointerEvents,this.regexOn=/^on/,this.regexMouseEvents=/^(dbl)?click$|^mouse(move|down|up|over|out|enter|leave)$|^contextmenu$/,this.regexUiEvents=/^(focus|blur|select|change|reset)$|^key(press|down|up)$/,this.regexHtmlEvents=/^(scroll|resize|(un)?load|abort|error)$/,this.useEventConstructors=!0;try{new MouseEvent("click")}catch(t){this.useEventConstructors=!1}this.mode=void 0===e?this.pointerEventsSupport?"PointerEvents":"EventForwarding":e,this["init"+this.mode]&&this["init"+this.mode]()}initPointerEvents(){this.addCSS(".nonblock{transition:opacity .1s ease; pointer-events: none;}.nonblock:hover,.nonblock-hover{opacity:.1 !important;}"),this.onmousemove=(t=>{const e=document.querySelectorAll(".nonblock");for(let o of e){const e=o.getBoundingClientRect();t.clientX>=e.left&&t.clientX<=e.right&&t.clientY>=e.top&&t.clientY<=e.bottom?o.classList.contains("nonblock-hover")?this.isSimulateMouse(o)&&t.isTrusted&&this.domEvent(o,"onmousemove",t,!0):(o.classList.add("nonblock-hover"),this.isSimulateMouse(o)&&t.isTrusted&&(this.domEvent(o,"onmouseenter",t,!1),this.domEvent(o,"onmouseover",t,!0))):o.classList.contains("nonblock-hover")&&(this.isSimulateMouse(o)&&t.isTrusted&&(this.domEvent(o,"onmouseout",t,!0),this.domEvent(o,"onmouseleave",t,!1)),o.classList.remove("nonblock-hover"))}}),this.root.addEventListener("mousemove",this.onmousemove)}initEventForwarding(){this.addCSS(".nonblock{transition:opacity .1s ease;}\n.nonblock:hover{opacity:.1 !important;}\n.nonblock-hide{position:absolute !important;left:-10000000px !important;right:10000000px !important;}\n.nonblock-cursor-auto{cursor:auto !important;}\n.nonblock-cursor-default{cursor:default !important;}\n.nonblock-cursor-none{cursor:none !important;}\n.nonblock-cursor-context-menu{cursor:context-menu !important;}\n.nonblock-cursor-help{cursor:help !important;}\n.nonblock-cursor-pointer{cursor:pointer !important;}\n.nonblock-cursor-progress{cursor:progress !important;}\n.nonblock-cursor-wait{cursor:wait !important;}\n.nonblock-cursor-cell{cursor:cell !important;}\n.nonblock-cursor-crosshair{cursor:crosshair !important;}\n.nonblock-cursor-text{cursor:text !important;}\n.nonblock-cursor-vertical-text{cursor:vertical-text !important;}\n.nonblock-cursor-alias{cursor:alias !important;}\n.nonblock-cursor-copy{cursor:copy !important;}\n.nonblock-cursor-move{cursor:move !important;}\n.nonblock-cursor-no-drop{cursor:no-drop !important;}\n.nonblock-cursor-not-allowed{cursor:not-allowed !important;}\n.nonblock-cursor-all-scroll{cursor:all-scroll !important;}\n.nonblock-cursor-col-resize{cursor:col-resize !important;}\n.nonblock-cursor-row-resize{cursor:row-resize !important;}\n.nonblock-cursor-n-resize{cursor:n-resize !important;}\n.nonblock-cursor-e-resize{cursor:e-resize !important;}\n.nonblock-cursor-s-resize{cursor:s-resize !important;}\n.nonblock-cursor-w-resize{cursor:w-resize !important;}\n.nonblock-cursor-ne-resize{cursor:ne-resize !important;}\n.nonblock-cursor-nw-resize{cursor:nw-resize !important;}\n.nonblock-cursor-se-resize{cursor:se-resize !important;}\n.nonblock-cursor-sw-resize{cursor:sw-resize !important;}\n.nonblock-cursor-ew-resize{cursor:ew-resize !important;}\n.nonblock-cursor-ns-resize{cursor:ns-resize !important;}\n.nonblock-cursor-nesw-resize{cursor:nesw-resize !important;}\n.nonblock-cursor-nwse-resize{cursor:nwse-resize !important;}\n.nonblock-cursor-zoom-in{cursor:zoom-in !important;}\n.nonblock-cursor-zoom-out{cursor:zoom-out !important;}\n.nonblock-cursor-grab{cursor:grab !important;}\n.nonblock-cursor-grabbing{cursor:grabbing !important;}"),this.nonBlockLastElem=null,this.isOverTextNode=!1,this.selectingText=!1,this.onmouseenter=(t=>{let e;t.isTrusted&&(e=this.getNonBlocking(t.target))&&(this.nonBlockLastElem=!1,this.isPropagating(e)||t.stopPropagation())}),this.onmouseleave=(t=>{let e;t.isTrusted&&(e=this.getNonBlocking(t.target))&&(this.remCursor(e),this.nonBlockLastElem=null,this.selectingText=!1,this.isPropagating(e)||t.stopPropagation())}),this.onmouseover=(t=>{let e;t.isTrusted&&(e=this.getNonBlocking(t.target))&&!this.isPropagating(e)&&t.stopPropagation()}),this.onmouseout=(t=>{let e;t.isTrusted&&(e=this.getNonBlocking(t.target))&&!this.isPropagating(e)&&t.stopPropagation()}),this.onmousemove=(t=>{let e;t.isTrusted&&(e=this.getNonBlocking(t.target))&&(this.nonblockPass(e,t,"onmousemove"),null===this.selectingText?(window.getSelection().removeAllRanges(),this.selectingText=!0):this.selectingText&&t.preventDefault(),this.isPropagating(e)||t.stopPropagation())}),this.onmousedown=(t=>{let e;t.isTrusted&&(e=this.getNonBlocking(t.target))&&(this.nonblockPass(e,t,"onmousedown"),this.selectingText=null,this.isFocusable(e)||t.preventDefault(),this.isPropagating(e)&&this.isActionPropagating(e)||t.stopPropagation())}),this.onmouseup=(t=>{let e;t.isTrusted&&(e=this.getNonBlocking(t.target))&&(this.nonblockPass(e,t,"onmouseup"),null===this.selectingText&&window.getSelection().removeAllRanges(),this.selectingText=!1,this.isPropagating(e)&&this.isActionPropagating(e)||t.stopPropagation())}),this.onclick=(t=>{let e;t.isTrusted&&(e=this.getNonBlocking(t.target))&&(this.nonblockPass(e,t,"onclick"),this.isPropagating(e)&&this.isActionPropagating(e)||t.stopPropagation())}),this.ondblclick=(t=>{let e;t.isTrusted&&(e=this.getNonBlocking(t.target))&&(this.nonblockPass(e,t,"ondblclick"),this.isPropagating(e)&&this.isActionPropagating(e)||t.stopPropagation())}),this.root.addEventListener("mouseenter",this.onmouseenter,!0),this.root.addEventListener("mouseleave",this.onmouseleave,!0),this.root.addEventListener("mouseover",this.onmouseover,!0),this.root.addEventListener("mouseout",this.onmouseout,!0),this.root.addEventListener("mousemove",this.onmousemove,!0),this.root.addEventListener("mousedown",this.onmousedown,!0),this.root.addEventListener("mouseup",this.onmouseup,!0),this.root.addEventListener("click",this.onclick,!0),this.root.addEventListener("dblclick",this.ondblclick,!0)}destroy(){for(let t of["mouseenter","mouseleave","mouseover","mouseout","mousemove","mousedown","mouseup","click","dblclick"])this["on"+t]&&(this.root.removeEventListener(t,this["on"+t],!0),delete this["on"+t]);this.styling.parentNode.removeChild(this.styling),delete this.styling}addCSS(t){this.styling=document.createElement("style"),this.styling.setAttribute("type","text/css"),this.styling.styleSheet?this.styling.styleSheet.cssText=t:this.styling.appendChild(document.createTextNode(t)),document.getElementsByTagName("head")[0].appendChild(this.styling)}domEvent(t,e,o,n){let s;if(e=e.toLowerCase(),this.useEventConstructors){if((e=e.replace(this.regexOn,"")).match(this.regexMouseEvents)?s=new MouseEvent(e,{screenX:o.screenX,screenY:o.screenY,clientX:o.clientX,clientY:o.clientY,ctrlKey:o.ctrlKey,shiftKey:o.shiftKey,altKey:o.altKey,metaKey:o.metaKey,button:o.button,buttons:o.buttons,relatedTarget:o.relatedTarget,region:o.region,detail:o.detail,view:o.view,bubbles:void 0===n?o.bubbles:n,cancelable:o.cancelable,composed:o.composed}):e.match(this.regexUiEvents)?s=new UIEvent(e,{detail:o.detail,view:o.view,bubbles:void 0===n?o.bubbles:n,cancelable:o.cancelable,composed:o.composed}):e.match(this.regexHtmlEvents)&&(s=new Event(e,{bubbles:void 0===n?o.bubbles:n,cancelable:o.cancelable,composed:o.composed})),!s)return;t.dispatchEvent(s)}else if(document.createEvent&&t.dispatchEvent){if((e=e.replace(this.regexOn,"")).match(this.regexMouseEvents)?(t.getBoundingClientRect(),(s=document.createEvent("MouseEvents")).initMouseEvent(e,void 0===n?o.bubbles:n,o.cancelable,o.view,o.detail,o.screenX,o.screenY,o.clientX,o.clientY,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.button,o.relatedTarget)):e.match(this.regexUiEvents)?(s=document.createEvent("UIEvents")).initUIEvent(e,void 0===n?o.bubbles:n,o.cancelable,o.view,o.detail):e.match(this.regexHtmlEvents)&&(s=document.createEvent("HTMLEvents")).initEvent(e,void 0===n?o.bubbles:n,o.cancelable),!s)return;t.dispatchEvent(s)}else e.match(this.regexOn)||(e="on"+e),s=document.createEventObject(o),t.fireEvent(e,s)}nonblockPass(t,e,o){t.classList.add("nonblock-hide");const n=document.elementFromPoint(e.clientX,e.clientY);let s,i,r,c,l;!1===this.nonBlockLastElem&&(this.nonBlockLastElem=n),document.caretPositionFromPoint?(i=(s=document.caretPositionFromPoint(e.clientX,e.clientY))?s.offsetNode:null,l=s?s.offset:null):document.caretRangeFromPoint&&(i=(s=document.caretRangeFromPoint(e.clientX,e.clientY))?s.endContainer:null,l=s?s.endOffset:null),s&&(r=s.startContainer.textContent.match(/^[\s\n]*/)[0],c=s.startContainer.textContent.replace(/[\s\n]+$/g,"")),t.classList.remove("nonblock-hide");let a=this.getCursor(n);if(this.isOverTextNode=!1,"auto"===a&&"A"===n.tagName?a="pointer":s&&(!r.length||l>r.length)&&l<c.length&&("auto"===a&&(a="text"),this.isOverTextNode=!0),s&&this.selectingText&&l>0){const t=window.getSelection();let e;0===t.rangeCount?(this.selectingText={originContainer:s.startContainer?s.startContainer:i,originOffset:l-1},e=document.createRange(),t.addRange(e)):e=t.getRangeAt(0),i===this.selectingText.originContainer&&l<this.selectingText.originOffset||i.compareDocumentPosition(this.selectingText.originContainer)&Node.DOCUMENT_POSITION_FOLLOWING?(e.setEnd(this.selectingText.originContainer,this.selectingText.originOffset),e.setStart(i,l)):(e.setStart(this.selectingText.originContainer,this.selectingText.originOffset),e.setEnd(i,l))}if(this.setCursor(t,"auto"!==a?a:"default"),!this.nonBlockLastElem||this.nonBlockLastElem!==n){if(this.nonBlockLastElem){const t=this.nonBlockLastElem;t.contains(n)||this.domEvent(t,"mouseleave",e,!1),this.domEvent(t,"mouseout",e,!0),n.contains(t)||this.domEvent(n,"mouseenter",e,!1)}else n.contains(t)||this.domEvent(n,"mouseenter",e,!1);this.domEvent(n,"mouseover",e,!0)}"onmousedown"===o&&(document.activeElement&&document.activeElement.blur(),n.focus({preventScroll:!0})),this.domEvent(n,o,e),this.nonBlockLastElem=n}getNonBlocking(t){let e=t;for(;e;){if(e.classList&&e.classList.contains("nonblock"))return e;e=e.parentNode}return!1}isPropagating(t){return!t.classList.contains("nonblock-stop-propagation")}isActionPropagating(t){return t.classList.contains("nonblock-allow-action-propagation")}isFocusable(t){return t.classList.contains("nonblock-allow-focus")}isSimulateMouse(t){return!t.classList.contains("nonblock-stop-mouse-simulation")}getCursor(t){return window.getComputedStyle(t).getPropertyValue("cursor")}setCursor(t,e){t.classList.contains("nonblock-cursor-"+e)||(this.remCursor(t),t.classList.add("nonblock-cursor-"+e))}remCursor(t){[...Object.keys(t.classList).map(e=>t.classList[e])].forEach(e=>{0===e.indexOf("nonblock-cursor-")&&t.classList.remove(e)})}}})());
//# sourceMappingURL=NonBlock.js.map
